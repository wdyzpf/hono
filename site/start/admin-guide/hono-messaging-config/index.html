<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Hono Messaging Configuration - Eclipse Hono</title>
    <meta name="generator" content="Hugo 0.42" />

    
    <meta name="description" content="A set of micro-services for connecting millions of devices.">
    
    <link rel="canonical" href="https://www.eclipse.org/hono/admin-guide/hono-messaging-config/">
    
    <meta name="author" content="The Eclipse Hono Project">
    

    <meta property="og:url" content="https://www.eclipse.org/hono/admin-guide/hono-messaging-config/">
    <meta property="og:title" content="Eclipse Hono">
    <meta property="og:image" content="https://www.eclipse.org/hono/images/logo-32x32px.png">
    <meta name="apple-mobile-web-app-title" content="Eclipse Hono">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://www.eclipse.org/hono/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://www.eclipse.org/hono/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://www.eclipse.org/hono/fonts/icon.eot');
        src: url('https://www.eclipse.org/hono/fonts/icon.eot')
               format('embedded-opentype'),
             url('https://www.eclipse.org/hono/fonts/icon.woff')
               format('woff'),
             url('https://www.eclipse.org/hono/fonts/icon.ttf')
               format('truetype'),
             url('https://www.eclipse.org/hono/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://www.eclipse.org/hono/stylesheets/application.css">
    <link rel="stylesheet" href="https://www.eclipse.org/hono/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://www.eclipse.org/hono/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://www.eclipse.org/hono/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <link rel="stylesheet" href="https://www.eclipse.org/hono/css/hono.css">
    
    <link rel="stylesheet" href="//www.eclipse.org/eclipse.org-common/themes/solstice/public/stylesheets/vendor/cookieconsent/cookieconsent.min.css">
    
    <script src="https://www.eclipse.org/hono/javascripts/modernizr.js"></script>
    <script src="//www.eclipse.org/eclipse.org-common/themes/solstice/public/javascript/vendor/cookieconsent/default.min.js"></script>

    

  </head>
  <body class="palette-primary-orange palette-accent-teal">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Hono Messaging Configuration
      </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/eclipse/hono" title="@eclipse/hono on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://www.eclipse.org/hono/" class="project">
    <div class="banner">
      
        <div class="drawerlogo">
          <img src="https://www.eclipse.org/hono/images/logo-32x32px.png">
        </div>
      
      <div class="name">
        <strong>Eclipse Hono&trade; </strong>
        
          <br>
          eclipse/hono
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="https://www.eclipse.org/hono/download/" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/eclipse/hono/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Getting started" href="/hono/getting-started/">
	
	Getting started
</a>



  
</li>



<li>
  
    



<a  title="Downloads" href="/hono/download/">
	
	Downloads
</a>



  
</li>



<li>
  
    



<a  title="Sandbox" href="/hono/sandbox/">
	
	Sandbox
</a>



  
</li>



<li>
  
    



<a  title="Concepts" href="/hono/concepts/">
	
	Concepts
</a>



  
</li>



<li>
  
    



<a  title="User Guide" href="/hono/user-guide/">
	
	User Guide
</a>



  
</li>



<li>
  
    



<a  title="Admin Guide" href="/hono/admin-guide/">
	
	Admin Guide
</a>



  
</li>



<li>
  
    



<a  title="Developer Guide" href="/hono/dev-guide/">
	
	Developer Guide
</a>



  
</li>



<li>
  
    



<a  title="API" href="/hono/api/">
	
	API
</a>



  
</li>



<li>
  
    



<a  title="Deployment" href="/hono/deployment/">
	
	Deployment
</a>



  
</li>



<li>
  
    



<a  title="Architecture" href="/hono/architecture/">
	
	Architecture
</a>



  
</li>



<li>
  
    



<a  title="Community" href="/hono/community/">
	
	Community
</a>



  
</li>



<li>
  
    



<a  title="License" href="/hono/license/">
	
	License
</a>



  
</li>


        </ul>
        

        
        <hr>
        <span class="section">Build Status:</span>

        <ul>
          
          <li>
            <a href="https://ci.eclipse.org/hono/job/Hono-CI/" title="Eclipse Build Status" target="_blank">
              <img src="https://ci.eclipse.org/hono/buildStatus/icon?job=Hono-CI">
            </a>
          </li>
          

          <li>
            <a href="https://travis-ci.org/eclipse/hono" title="Travis Build Status" target="_blank">
              <img src="https://travis-ci.org/eclipse/hono.svg?branch=master" />
            </a>
          </li>
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Hono Messaging Configuration </h1>

			<p>The Hono Messaging component exposes service endpoints implementing the <em>south bound</em> part of Eclipse Hono&trade;&rsquo;s <a href="/hono/api/telemetry-api/">Telemetry</a> and <a href="/hono/api/event-api/">Event</a> APIs.
The south bound API is used by protocol adapters to upload telemetry data and events to be forwarded to downstream consumers.
</p>

<p>The component is implemented as a Spring Boot application. It can be run either directly from the command line or by means of starting the corresponding <a href="https://hub.docker.com/r/eclipse/hono-service-messaging/">Docker image</a> created from it.</p>

<h2 id="service-configuration">Service Configuration</h2>

<p>The following table provides an overview of the environment variables and corresponding command line options for configuring the Hono Messaging component.</p>

<table>
<thead>
<tr>
<th align="left">Environment Variable<br>Command Line Option</th>
<th align="center">Mandatory</th>
<th align="left">Default</th>
<th align="left">Description</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left"><code>HONO_APP_MAX_INSTANCES</code><br><code>--hono.app.maxInstances</code></td>
<td align="center">no</td>
<td align="left"><em>#CPU cores</em></td>
<td align="left">The number of verticle instances to deploy. If not set, one verticle per processor core is deployed.</td>
</tr>

<tr>
<td align="left"><code>HONO_APP_HEALTH_CHECK_PORT</code><br><code>--hono.app.healthCheckPort</code></td>
<td align="center">no</td>
<td align="left">-</td>
<td align="left">The port that the HTTP server, which exposes the service&rsquo;s health check resources, should bind to. If set, the adapter will expose a <em>readiness</em> probe at URI <code>/readiness</code> and a <em>liveness</em> probe at URI <code>/liveness</code>.</td>
</tr>

<tr>
<td align="left"><code>HONO_APP_HEALTH_CHECK_BIND_ADDRESS</code><br><code>--hono.app.healthCheckBindAddress</code></td>
<td align="center">no</td>
<td align="left"><code>127.0.0.1</code></td>
<td align="left">The IP address of the network interface that the HTTP server, which exposes the service&rsquo;s health check resources, should be bound to. The HTTP server will only be started if <code>HONO_APP_HEALTH_CHECK_BIND_ADDRESS</code> is set explicitly.</td>
</tr>

<tr>
<td align="left"><code>HONO_MESSAGING_ASSERTION_VALIDATION_REQUIRED</code><br><code>--hono.messaging.assertionValidationRequired</code></td>
<td align="center">no</td>
<td align="left"><code>true</code></td>
<td align="left">A flag for controlling whether Hono Messaging should require messages published by devices to contain a valid registration assertion. This property is useful for testing purpose and should not be set to <code>false</code> in production environments.</td>
</tr>

<tr>
<td align="left"><code>HONO_MESSAGING_BIND_ADDRESS</code><br><code>--hono.messaging.bindAddress</code></td>
<td align="center">no</td>
<td align="left"><code>127.0.0.1</code></td>
<td align="left">The IP address of the network interface that the secure port should be bound to.<br>See <a href="#port-configuration">Port Configuration</a> below for details.</td>
</tr>

<tr>
<td align="left"><code>HONO_MESSAGING_CERT_PATH</code><br><code>--hono.messaging.certPath</code></td>
<td align="center">no</td>
<td align="left">-</td>
<td align="left">The absolute path to the PEM file containing the certificate that the service should use for authenticating to clients. This option must be used in conjunction with <code>HONO_MESSAGING_KEY_PATH</code>.<br>Alternatively, the <code>HONO_MESSAGING_KEY_STORE_PATH</code> option can be used to configure a key store containing both the key as well as the certificate.</td>
</tr>

<tr>
<td align="left"><code>HONO_MESSAGING_INSECURE_PORT</code><br><code>--hono.messaging.insecurePort</code></td>
<td align="center">no</td>
<td align="left">-</td>
<td align="left">The insecure port the service should listen on.<br>See <a href="#port-configuration">Port Configuration</a> below for details.</td>
</tr>

<tr>
<td align="left"><code>HONO_MESSAGING_INSECURE_PORT_BIND_ADDRESS</code><br><code>--hono.messaging.insecurePortBindAddress</code></td>
<td align="center">no</td>
<td align="left"><code>127.0.0.1</code></td>
<td align="left">The IP address of the network interface that the insecure port should be bound to.<br>See <a href="#port-configuration">Port Configuration</a> below for details.</td>
</tr>

<tr>
<td align="left"><code>HONO_MESSAGING_INSECURE_PORT_ENABLED</code><br><code>--hono.messaging.insecurePortEnabled</code></td>
<td align="center">no</td>
<td align="left"><code>false</code></td>
<td align="left">If set to <code>true</code> the service will open an insecure port (not secured by TLS) using either the port number set via <code>HONO_MESSAGING_INSECURE_PORT</code> or the default AMQP port number (<code>5672</code>) if not set explicitly.<br>See <a href="#port-configuration">Port Configuration</a> below for details.</td>
</tr>

<tr>
<td align="left"><code>HONO_MESSAGING_KEY_PATH</code><br><code>--hono.messaging.keyPath</code></td>
<td align="center">no</td>
<td align="left">-</td>
<td align="left">The absolute path to the (PKCS8) PEM file containing the private key that the service should use for authenticating to clients. Note that the private key is not protected by a password. You should therefore make sure that the key file can only be read by the user that the server process is running under. This option must be used in conjunction with <code>HONO_MESSAGING_CERT_PATH</code>. Alternatively, the <code>HONO_MESSAGING_KEY_STORE_PATH</code> option can be used to configure a key store containing both the key as well as the certificate.</td>
</tr>

<tr>
<td align="left"><code>HONO_MESSAGING_KEY_STORE_PASSWORD</code><br><code>--hono.messaging.keyStorePassword</code></td>
<td align="center">no</td>
<td align="left">-</td>
<td align="left">The password required to read the contents of the key store.</td>
</tr>

<tr>
<td align="left"><code>HONO_MESSAGING_KEY_STORE_PATH</code><br><code>--hono.messaging.keyStorePath</code></td>
<td align="center">no</td>
<td align="left">-</td>
<td align="left">The absolute path to the Java key store containing the private key and certificate that the service should use for authenticating to clients. Either this option or the <code>HONO_MESSAGING_KEY_PATH</code> and <code>HONO_MESSAGING_CERT_PATH</code> options need to be set in order to enable TLS secured connections with clients. The key store format can be either <code>JKS</code> or <code>PKCS12</code> indicated by a <code>.jks</code> or <code>.p12</code> file suffix respectively.</td>
</tr>

<tr>
<td align="left"><code>HONO_MESSAGING_MAX_SESSION_WINDOW</code><br><code>--hono.messaging.maxSessionWindow</code></td>
<td align="center">no</td>
<td align="left"><code>9830400</code></td>
<td align="left">The maximum session window size used by Hono Messaging for sessions created by a client. The default size allows for buffering 300 unsettled transfers of 32kb each. This value effectively limits the maximum amount of memory used by Hono Messaging per AMQP session. The value may be adjusted to make better use of the memory available. The larger the value, the more unsettled messages can be <em>in flight</em> at any given time which might help increasing the overall throughput of the system.</td>
</tr>

<tr>
<td align="left"><code>HONO_MESSAGING_PORT</code><br><code>--hono.messaging.port</code></td>
<td align="center">no</td>
<td align="left"><code>5671</code></td>
<td align="left">The secure port that the service should listen on.<br>See <a href="#port-configuration">Port Configuration</a> below for details.</td>
</tr>

<tr>
<td align="left"><code>HONO_MESSAGING_SECURE_PROTOCOLS</code><br><code>--hono.messaging.secureProtocols</code></td>
<td align="center">no</td>
<td align="left"><code>TLSv1.2</code></td>
<td align="left">A (comma separated) list of secure protocols that are supported when negotiating TLS sessions. Please refer to the <a href="https://vertx.io/docs/vertx-core/java/#ssl">vert.x documentation</a> for a list of supported protocol names.</td>
</tr>

<tr>
<td align="left"><code>HONO_MESSAGING_VALIDATION_CERT_PATH</code><br><code>--hono.messaging.validation.certPath</code></td>
<td align="center">yes</td>
<td align="left">-</td>
<td align="left">The path to a PEM file containing the <em>Device Registration</em> service&rsquo;s certificate. The public key contained in the certificate is used to validate RSA based registration assertion tokens issued by the <em>Device Registration</em> service. Either this variable or <code>HONO_MESSAGING_VALIDATION_SHARED_SECRET</code> must be set in order for the Hono Messaging component being able to process telemetry data and events received from devices.</td>
</tr>

<tr>
<td align="left"><code>HONO_MESSAGING_VALIDATION_SHARED_SECRET</code><br><code>--hono.messaging.validation.sharedSecret</code></td>
<td align="center">yes</td>
<td align="left">-</td>
<td align="left">The secret to use for validating tokens asserting the registration status of devices using HmacSHA256. The secret&rsquo;s UTF8 encoding must consist of at least 32 bytes. Either this variable or <code>HONO_MESSAGING_VALIDATION_CERT_PATH</code> must be set in order for the Hono Messaging component being able to process telemetry data and events received from devices.</td>
</tr>

<tr>
<td align="left"><code>HONO_METRIC_REPORTER_GRAPHITE_ACTIVE</code><br><code>--hono.metric.reporter.graphite.active</code></td>
<td align="center">no</td>
<td align="left"><code>false</code></td>
<td align="left">Activates the metrics reporter to Graphite (or a graphite compatible system - we use InfluxDB in the <code>example</code>).</td>
</tr>

<tr>
<td align="left"><code>HONO_METRIC_REPORTER_GRAPHITE_HOST</code><br><code>--hono.metric.reporter.graphite.host</code></td>
<td align="center">no</td>
<td align="left"><code>localhost</code></td>
<td align="left">Sets the host, to which the metrics will be reported.</td>
</tr>

<tr>
<td align="left"><code>HONO_METRIC_REPORTER_GRAPHITE_PORT</code><br><code>--hono.metric.reporter.graphite.host</code></td>
<td align="center">no</td>
<td align="left"><code>2003</code></td>
<td align="left">Sets the port - 2003 ist standard for Graphite.</td>
</tr>

<tr>
<td align="left"><code>HONO_METRIC_REPORTER_GRAPHITE_PERIOD</code><br><code>--hono.metric.reporter.graphite.period</code></td>
<td align="center">no</td>
<td align="left"><code>5000</code></td>
<td align="left">Sets the time interval for reporting.</td>
</tr>

<tr>
<td align="left"><code>HONO_METRIC_REPORTER_GRAPHITE_PREFIX</code><br><code>--hono.metric.reporter.graphite.prefix</code></td>
<td align="center">no</td>
<td align="left">-</td>
<td align="left">Prefix all metric names with the given string.</td>
</tr>

<tr>
<td align="left"><code>HONO_METRIC_REPORTER_CONSOLE_ACTIVE</code><br><code>--hono.metric.reporter.console.active</code></td>
<td align="center">no</td>
<td align="left"><code>false</code></td>
<td align="left">Activates the metrics reporter to the console/log.</td>
</tr>

<tr>
<td align="left"><code>HONO_METRIC_REPORTER_CONSOLE_PERIOD</code><br><code>--hono.metric.reporter.console.period</code></td>
<td align="center">no</td>
<td align="left"><code>5000</code></td>
<td align="left">Sets the time interval for reporting.</td>
</tr>

<tr>
<td align="left"><code>HONO_METRIC_JVM_MEMORY</code><br><code>--hono.metric.jvm.memory</code></td>
<td align="center">no</td>
<td align="left"><code>false</code></td>
<td align="left">Activates JVM memory metrics (from the Dropwizard JVM Instrumentation). The metric name is <code>hono.messaging.jvm.memory</code>.</td>
</tr>

<tr>
<td align="left"><code>HONO_METRIC_JVM_THREAD</code><br><code>--hono.metric.jvm.thread</code></td>
<td align="center">no</td>
<td align="left"><code>false</code></td>
<td align="left">Activates JVM thread metrics (from the Dropwizard JVM Instrumentation). The metric name is <code>hono.messaging.jvm.thread</code>.</td>
</tr>

<tr>
<td align="left"><code>HONO_METRIC_VERTX</code><br><code>--hono.metric.vertx</code></td>
<td align="center">no</td>
<td align="left"><code>false</code></td>
<td align="left">Activates the Vert.x metrics (from the Vert.x metrics project). The metric name is <code>hono.messaging.vertx</code>.</td>
</tr>
</tbody>
</table>

<p>The variables only need to be set if the default value does not match your environment.</p>

<h2 id="port-configuration">Port Configuration</h2>

<p>The Hono Messaging component can be configured to listen for connections on</p>

<ul>
<li>a secure port only (default) or</li>
<li>an insecure port only or</li>
<li>both a secure and an insecure port (dual port configuration)</li>
</ul>

<p>The server will fail to start if none of the ports is configured properly.</p>

<h3 id="secure-port-only">Secure Port Only</h3>

<p>The service needs to be configured with a private key and certificate in order to open a TLS secured port.</p>

<p>There are two alternative ways for doing so:</p>

<ol>
<li>Setting the <code>HONO_MESSAGING_KEY_STORE_PATH</code> and the <code>HONO_MESSAGING_KEY_STORE_PASSWORD</code> variables in order to load the key &amp; certificate from a password protected key store, or</li>
<li>setting the <code>HONO_MESSAGING_KEY_PATH</code> and <code>HONO_MESSAGING_CERT_PATH</code> variables in order to load the key and certificate from two separate PEM files in PKCS8 format.</li>
</ol>

<p>When starting up, the service will bind a TLS secured socket to the default secure AMQP port 5671. The port number can also be set explicitly using the <code>HONO_MESSAGING_PORT</code> variable.</p>

<p>The <code>HONO_MESSAGING_BIND_ADDRESS</code> variable can be used to specify the network interface that the port should be exposed on. By default the port is bound to the <em>loopback device</em> only, i.e. the port will only be accessible from the local host. Setting this variable to <code>0.0.0.0</code> will let the port being bound to <strong>all</strong> network interfaces (be careful not to expose the port unintentionally to the outside world).</p>

<h3 id="insecure-port-only">Insecure Port Only</h3>

<p>The secure port will mostly be required for production scenarios. However, it might be desirable to expose a non-TLS secured port instead, e.g. for testing purposes. In any case, the non-secure port needs to be explicitly enabled either by</p>

<ul>
<li>explicitly setting <code>HONO_MESSAGING_INSECURE_PORT</code> to a valid port number, or by</li>
<li>implicitly configuring the default AMQP port (5672) by simply setting <code>HONO_MESSAGING_INSECURE_PORT_ENABLED</code> to <code>true</code>.</li>
</ul>

<p>The service issues a warning on the console if <code>HONO_MESSAGING_INSECURE_PORT</code> is set to the default secure AMQP port (5671).</p>

<p>The <code>HONO_MESSAGING_INSECURE_PORT_BIND_ADDRESS</code> variable can be used to specify the network interface that the port should be exposed on. By default the port is bound to the <em>loopback device</em> only, i.e. the port will only be accessible from the local host. This variable might be used to e.g. expose the non-TLS secured port on a local interface only, thus providing easy access from within the local network, while still requiring encrypted communication when accessed from the outside over public network infrastructure.</p>

<p>Setting this variable to <code>0.0.0.0</code> will let the port being bound to <strong>all</strong> network interfaces (be careful not to expose the port unintentionally to the outside world).</p>

<h3 id="dual-port">Dual Port</h3>

<p>In test setups and some production scenarios the Hono Messaging component may be configured to open a secure <strong>and</strong> an insecure port at the same time.</p>

<p>This is achieved by configuring both ports correctly (see above). The service will fail to start if both ports are configured to use the same port number.</p>

<p>Since the secure port may need different visibility in the network setup compared to the secure port, it has it&rsquo;s own binding address <code>HONO_MESSAGING_INSECURE_PORT_BIND_ADDRESS</code>.
This can be used to narrow the visibility of the insecure port to a local network e.g., while the secure port may be visible worldwide.</p>

<h3 id="ephemeral-ports">Ephemeral Ports</h3>

<p>The service may be configured to open both a secure and a non-secure port at the same time simply by configuring both ports as described above. For this to work, both ports must be configured to use different port numbers, otherwise startup will fail.</p>

<h2 id="authentication-service-connection-configuration">Authentication Service Connection Configuration</h2>

<p>The Hono Messaging component requires a connection to an implementation of Hono&rsquo;s Authentication API in order to authenticate and authorize client requests.</p>

<p>The connection is configured according to <a href="/hono/admin-guide/hono-client-configuration/">Hono Client Configuration</a>
where the <code>${PREFIX}</code> is set to <code>HONO_AUTH</code>. Since Hono&rsquo;s Authentication Service does not allow caching of the responses, the cache properties
can be ignored.</p>

<p>In addition to the standard client configuration properties, following properties need to be set for the connection:</p>

<table>
<thead>
<tr>
<th align="left">Environment Variable<br>Command Line Option</th>
<th align="center">Mandatory</th>
<th align="left">Default</th>
<th align="left">Description</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left"><code>HONO_AUTH_CERT_PATH</code><br><code>--hono.auth.certPath</code></td>
<td align="center">no</td>
<td align="left">-</td>
<td align="left">The absolute path to the PEM file containing the public key that the service should use to authenticate when verifying reachability of the Authentication service as part of a periodic health check. The health check needs to be enabled explicitly by means of setting the <code>HONO_APP_HEALTH_CHECK_PORT</code> variable. This variable needs to be set in conjunction with <code>HONO_AUTH_KEY_PATH</code>.</td>
</tr>

<tr>
<td align="left"><code>HONO_AUTH_KEY_PATH</code><br><code>--hono.auth.keyPath</code></td>
<td align="center">no</td>
<td align="left">-</td>
<td align="left">The absolute path to the PEM file containing the private key that the service should use to authenticate when verifying reachability of the Authentication service as part of a periodic health check. The health check needs to be enabled explicitly by means of setting the <code>HONO_APP_HEALTH_CHECK_PORT</code> variable. This variable needs to be set in conjunction with <code>HONO_AUTH_CERT_PATH</code>.</td>
</tr>

<tr>
<td align="left"><code>HONO_AUTH_VALIDATION_CERT_PATH</code><br><code>--hono.auth.validation.certPath</code></td>
<td align="center">no</td>
<td align="left">-</td>
<td align="left">The absolute path to the PEM file containing the public key that the service should use for validating tokens issued by the Authentication service. Alternatively, a symmetric key can be used for validating tokens by setting the <code>HONO_AUTH_VALIDATION_SHARED_SECRET</code> variable. If none of these variables is set, startup of the service fails.</td>
</tr>

<tr>
<td align="left"><code>HONO_AUTH_VALIDATION_SHARED_SECRET</code><br><code>--hono.auth.validation.sharedSecret</code></td>
<td align="center">no</td>
<td align="left">-</td>
<td align="left">A string to derive a symmetric key from which is used for validating tokens issued by the Authentication service. The key is derived from the string by using the bytes of the String&rsquo;s UTF8 encoding. When setting the validation key using this variable, the Authentication service <strong>must</strong> be configured with the same key. Alternatively, an asymmetric key pair can be used for validating (and signing) by setting the <code>HONO_AUTH_VALIDATION_CERT_PATH</code> variable. If none of these variables is set, startup of the service fails.</td>
</tr>
</tbody>
</table>

<h2 id="amqp-1-0-messaging-network-connection-configuration">AMQP 1.0 Messaging Network Connection Configuration</h2>

<p>The Hono Messaging component forwards telemetry data and events produced by devices to an <em>AMQP 1.0 Messaging Network</em> for delivery to downstream consumers.
The following table provides an overview of the configuration variables and corresponding command line options for configuring the connection to the <em>AMQP 1.0 Messaging Network</em>.</p>

<table>
<thead>
<tr>
<th align="left">Environment Variable<br>Command Line Option</th>
<th align="center">Mandatory</th>
<th align="left">Default</th>
<th align="left">Description</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left"><code>HONO_DOWNSTREAM_HOST</code><br><code>--hono.downstream.host</code></td>
<td align="center">yes</td>
<td align="left"><code>localhost</code></td>
<td align="left">The IP address or name of the downstream <em>AMQP 1.0 Messaging Network</em> host. NB: This needs to be set to an address that can be resolved within the network the service runs on. When running as a Docker container, use Docker&rsquo;s <code>--network</code> command line option to attach the Hono Messaging container to the Docker network that the <em>AMQP 1.0 Messaging Network</em> containers are running on.</td>
</tr>

<tr>
<td align="left"><code>HONO_DOWNSTREAM_CERT_PATH</code><br><code>--hono.downstream.certPath</code></td>
<td align="center">no</td>
<td align="left">-</td>
<td align="left">The absolute path to the PEM file containing the certificate that the service should use for authenticating to the <em>AMQP 1.0 Messaging Network</em>. This option must be used in conjunction with <code>HONO_DOWNSTREAM_KEY_PATH</code>.<br>Alternatively, the <code>HONO_DOWNSTREAM_KEY_STORE_PATH</code> option can be used to configure a key store containing both the key as well as the certificate.</td>
</tr>

<tr>
<td align="left"><code>HONO_DOWNSTREAM_KEY_PATH</code><br><code>--hono.downstream.keyPath</code></td>
<td align="center">no</td>
<td align="left">-</td>
<td align="left">The absolute path to the (PKCS8) PEM file containing the private key that the service should use for authenticating to the <em>AMQP 1.0 Messaging Network</em>. Note that the private key is not protected by a password. You should therefore make sure that the key file can only be read by the user that the service process is running under. This option must be used in conjunction with <code>HONO_DOWNSTREAM_CERT_PATH</code>. Alternatively, the <code>HONO_DOWNSTREAM_KEY_STORE_PATH</code> option can be used to configure a key store containing both the key as well as the certificate.<br>This property (and the corresponding <code>HONO_DOWNSTREAM_CERT_PATH</code>) needs to be set only if the Messaging Network is configured to use <code>SASL EXTERNAL</code> for authenticating the Hono Messaging component.</td>
</tr>

<tr>
<td align="left"><code>HONO_DOWNSTREAM_KEY_STORE_PASSWORD</code><br><code>--hono.downstream.keyStorePassword</code></td>
<td align="center">no</td>
<td align="left">-</td>
<td align="left">The password required to read the contents of the key store.</td>
</tr>

<tr>
<td align="left"><code>HONO_DOWNSTREAM_KEY_STORE_PATH</code><br><code>--hono.downstream.keyStorePath</code></td>
<td align="center">no</td>
<td align="left">-</td>
<td align="left">The absolute path to the Java key store containing the private key and certificate that the service should use for authenticating to the <em>AMQP 1.0 Messaging Network</em>. Either this option or the <code>HONO_DOWNSTREAM_KEY_PATH</code> and <code>HONO_DOWNSTREAM_CERT_PATH</code> options need to be set in order to enable TLS secured connections. The key store format can be either <code>JKS</code> or <code>PKCS12</code> indicated by a <code>.jks</code> or <code>.p12</code> file suffix respectively.<br>This property (and the corresponding <code>HONO_DOWNSTREAM_KEY_STORE_PASSWORD</code>) needs to be set only if the Messaging Network is configured to use <code>SASL EXTERNAL</code> for authenticating the Hono Messaging component.</td>
</tr>

<tr>
<td align="left"><code>HONO_DOWNSTREAM_PASSWORD</code><br><code>--hono.downstream.password</code></td>
<td align="center">no</td>
<td align="left">-</td>
<td align="left">The password to use for authenticating to the <em>AMQP 1.0 Messaging Network</em>. This property (and the corresponding <em>username</em>) needs to be set only if the Messaging Network is configured to use <code>SASL PLAIN</code> for authenticating the Hono Messaging component.</td>
</tr>

<tr>
<td align="left"><code>HONO_DOWNSTREAM_PORT</code><br><code>--hono.downstream.port</code></td>
<td align="center">yes</td>
<td align="left"><code>5671</code></td>
<td align="left">The port that the <em>AMQP 1.0 Messaging Network</em> is listening on for connections from the Hono Messaging component.<br><strong>NB</strong> When using the Dispatch Router image with the example configuration then this property needs to be set to <code>5673</code>. This is because in the example configuration the Dispatch Router&rsquo;s <em>internal</em> listener used for accepting connections from the Hono Messaging component is configured to attach to port 5673.</td>
</tr>

<tr>
<td align="left"><code>HONO_DOWNSTREAM_TLS_ENABLED</code><br><code>--hono.downstream.tlsEnabled</code></td>
<td align="center">no</td>
<td align="left"><code>false</code></td>
<td align="left">If set to <code>true</code> the connection to the peer will be encrypted using TLS and the peer&rsquo;s identity will be verified using the JVM&rsquo;s configured standard trust store.<br>This variable only needs to be set to enable TLS explicitly if no specific trust store is configured using the <code>HONO_DOWNSTREAM_TRUST_STORE_PATH</code> variable.</td>
</tr>

<tr>
<td align="left"><code>HONO_DOWNSTREAM_TRUST_STORE_PASSWORD</code><br><code>--hono.downstream.trustStorePassword</code></td>
<td align="center">no</td>
<td align="left">-</td>
<td align="left">The password required to read the contents of the trust store.</td>
</tr>

<tr>
<td align="left"><code>HONO_DOWNSTREAM_TRUST_STORE_PATH</code><br><code>--hono.downstream.trustStorePath</code></td>
<td align="center">no</td>
<td align="left">-</td>
<td align="left">The absolute path to the Java key store containing the CA certificates the Hono Messaging component uses for authenticating the downstream AMQP 1.0 Messaging Network. This property <strong>must</strong> be set if the Messaging Network has been configured to support TLS. The key store format can be either <code>JKS</code>, <code>PKCS12</code> or <code>PEM</code> indicated by a <code>.jks</code>, <code>.p12</code> or <code>.pem</code> file suffix.</td>
</tr>

<tr>
<td align="left"><code>HONO_DOWNSTREAM_USERNAME</code><br><code>--hono.downstream.username</code></td>
<td align="center">no</td>
<td align="left">-</td>
<td align="left">The username to use for authenticating to the downstream <em>AMQP 1.0 Messaging Network</em>. This property (and the corresponding <em>password</em>) needs to be set only if the Messaging Network is configured to use <code>SASL PLAIN</code> for authenticating the Hono Messaging component.</td>
</tr>
</tbody>
</table>

<h2 id="run-as-a-docker-swarm-service">Run as a Docker Swarm Service</h2>

<p>Hono Messaging can be run as a Docker container from the command line. The following commands create and start Hono Messaging as a Docker Swarm service using the default keys  contained in the <code>demo-certs</code> module:</p>

<pre><code class="language-sh">~/hono$ docker secret create trusted-certs.pem demo-certs/certs/trusted-certs.pem
~/hono$ docker secret create auth-server-cert.pem demo-certs/certs/auth-server-cert.pem
~/hono$ docker secret create hono-messaging-key.pem demo-certs/certs/hono-messaging-key.pem
~/hono$ docker secret create hono-messaging-cert.pem demo-certs/certs/hono-messaging-cert.pem
~/hono$ docker service create --detach --name hono-service-messaging --network hono-net -p 5672:5672 \
&gt; --secret trusted-certs.pem \
&gt; --secret auth-server-cert.pem \
&gt; --secret hono-messaging-key.pem \
&gt; --secret hono-messaging-cert.pem \
&gt; -e 'HONO_AUTH_HOST=&lt;name or address of the auth-server&gt;' \
&gt; -e 'HONO_AUTH_TRUST_STORE_PATH=/run/secrets/trusted-certs.pem' \
&gt; -e 'HONO_AUTH_VALIDATION_CERT_PATH=/run/secrets/auth-server-cert.pem' \
&gt; -e 'HONO_DOWNSTREAM_HOST=&lt;name or address of the dispatch router&gt;' \
&gt; -e 'HONO_DOWNSTREAM_PORT=5673' \
&gt; -e 'HONO_DOWNSTREAM_KEY_PATH=/run/secrets/hono-messaging-key.pem' \
&gt; -e 'HONO_DOWNSTREAM_CERT_PATH=/run/secrets/hono-messaging-cert.pem' \
&gt; -e 'HONO_DOWNSTREAM_TRUST_STORE_PATH=/run/secrets/trusted-certs.pem' \
&gt; -e 'HONO_MESSAGING_VALIDATION_SHARED_SECRET=asharedsecretforvalidatingassertions' \
&gt; -e 'HONO_MESSAGING_KEY_PATH=/run/secrets/hono-messaging-key.pem' \
&gt; -e 'HONO_MESSAGING_CERT_PATH=/run/secrets/hono-messaging-cert.pem' \
&gt; -e 'HONO_MESSAGING_INSECURE_PORT_ENABLED=true' \
&gt; -e 'HONO_MESSAGING_INSECURE_PORT_BIND_ADDRESS=0.0.0.0' \
&gt; eclipse/hono-service-messaging:latest
</code></pre>

<div class="admonition note">
<p class="admonition-title"></p>
<p>There are several things noteworthy about the above command to start the service:</p>

<ol>
<li>The <em>secrets</em> need to be created once only, i.e. they only need to be removed and re-created if they are changed.</li>
<li>The <em>&ndash;network</em> command line switch is used to specify the <em>user defined</em> Docker network that the service should attach to. This is important so that other components can use Docker&rsquo;s DNS service to look up the (virtual) IP address of the service when they want to connect to it. For the same reason it is important that the service container is attached to the same network that the Dispatch Router is attached to so that the service can use the Dispatch Router&rsquo;s host name to connect to it via the Docker network.
Please refer to the <a href="https://docs.docker.com/engine/userguide/networking/#/user-defined-networks">Docker Networking Guide</a> for details regarding how to create a <em>user defined</em> network in Docker.</li>
<li>In cases where the Hono Messaging container requires a lot of configuration via environment variables (provided by means of <em>-e</em> switches), it is more convenient to put all environment variable definitions into a file and refer to it using Docker&rsquo;s <em>&ndash;env-file</em> command line switch when starting the container. This way the command line to start the container is much shorter and can be copied and edited more easily.</li>
</ol>
</p>
</div>

<h3 id="configuring-the-java-vm">Configuring the Java VM</h3>

<p>The Hono Messaging Docker image by default does not pass any specific configuration options to the Java VM. The VM can be configured using the standard <code>-X</code> options by means of setting the <code>_JAVA_OPTIONS</code> environment variable which is evaluated by the Java VM during start up.</p>

<p>Using the example from above, the following environment variable definition needs to be added to limit the VM&rsquo;s heap size to 256MB:</p>

<pre><code class="language-sh">...
&gt; -e '_JAVA_OPTIONS=-Xmx256m' \
&gt; eclipse/hono-service-messaging:latest
</code></pre>

<h2 id="run-using-the-docker-swarm-deployment-script">Run using the Docker Swarm Deployment Script</h2>

<p>In most cases it is much easier to start all of Hono&rsquo;s components in one shot using the Docker Swarm deployment script provided in the <code>example/target/deploy/docker</code> folder.</p>

<h2 id="run-the-spring-boot-application">Run the Spring Boot Application</h2>

<p>Sometimes it is helpful to run the Hono Messaging component from its jar file, e.g. in order to attach a debugger more easily or to take advantage of code replacement.
In order to do so, the service can be started using the <code>spring-boot:run</code> maven goal from the <code>services/messaging</code> folder.
The corresponding command to start up the service with the configuration used in the Docker example above looks like this:</p>

<pre><code class="language-sh">~/hono/services/messaging$ mvn spring-boot:run -Drun.arguments= \
&gt; --hono.auth.host=auth-server.hono,\
&gt; --hono.auth.trustStorePath=target/certs/trusted-certs.pem,\
&gt; --hono.auth.validation.certPath=target/certs/auth-server-cert.pem,\
&gt; --hono.auth.hostnameVerificationRequired=false,\
&gt; --hono.downstream.host=qdrouter.hono,\
&gt; --hono.downstream.port=5673,\
&gt; --hono.downstream.hostnameVerificationRequired=false,\
&gt; --hono.downstream.keyPath=target/certs/hono-messaging-key.pem,\
&gt; --hono.downstream.certPath=target/certs/hono-messaging-cert.pem,\
&gt; --hono.downstream.trustStorePath=target/certs/trusted-certs.pem,\
&gt; --hono.messaging.validation.sharedSecret=asharedsecretforvalidatingassertions,\
&gt; --hono.messaging.keyPath=target/certs/hono-messaging-key.pem,\
&gt; --hono.messaging.certPath=target/certs/hono-messaging-cert.pem,\
&gt; --hono.messaging.trustStorePath=target/certs/trusted-certs.pem,\
&gt; --hono.messaging.insecurePortEnabled=true,\
&gt; --hono.messaging.insecurePortBindAddress=0.0.0.0
</code></pre>

<div class="admonition note">
<p class="admonition-title"></p>
<p>In the example above the <em>hono.downstream.host=qdrouter.hono</em> command line option indicates that the Dispatch Router is running on a host with name <em>qdrouter.hono</em>. However, if the Dispatch Router has been started as a Docker container then the <em>qdrouter.hono</em> host name will most likely only be resolvable on the network that Docker has created for running the container on, i.e. when you run the Hono Messaging component from the Spring Boot application and want it to connect to a Dispatch Router run as a Docker container then you need to set the value of the <em>hono.downstream.host</em> option to the IP address (or name) of the Docker host running the Dispatch Router container. The same is true analogously for the <em>auth-server.hono</em> address.
The <em>hono.downstream.keyPath</em> option is required because the Dispatch Router requires the Hono Messaging component to authenticate by means of a client certificate during connection establishment.
The <em>hono.downstream.hostnameVerificationRequired</em> parameter is necessary to prevent the Hono Messaging component from validating the Dispatch Router&rsquo;s host name by means of comparing it to the <em>subjectAltNames</em> of the Dispatch Routers&rsquo;s certificate.
You may want to make logging of the Hono Messaging component a little more verbose by enabling the <em>dev</em> Spring profile.
To do so, append <em>-Drun.profiles=dev</em> to the command line.</p>
</div>

      <aside class="copyright" role="note">
  <div class="logo">
    <a href="https://www.eclipse.org" target="_blank">
      <img src="https://www.eclipse.org/hono/images/eclipse_foundation_logo.png" />
    </a>
  </div>
  <p class="notice">
    
    &copy; 2018 The Eclipse Hono Project &ndash;
    
    Documentation built with
    <a href="https://www.gohugo.io" target="_blank">Hugo</a>
    using the
    <a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
  </p>
  <p class="quickLinks">
    <a href="http://www.eclipse.org/legal/privacy.php" target="_blank">
      &gt; Privacy Policy
    </a>
    <a href="http://www.eclipse.org/legal/termsofuse.php" target="_blank">
      &gt; Terms of Use
    </a>
    <a href="http://www.eclipse.org/legal/copyright.php" target="_blank">
      &gt; Copyright Agent
    </a>
    <a href="http://www.eclipse.org/legal" target="_blank">
      &gt; Legal
    </a>
    <a href="https://eclipse.org/security" target="_blank">
      &gt; Report a Vulnerability
    </a>
  </p>
</aside>


			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://www.eclipse.org/hono/admin-guide/auth-server-config/" title="Auth Server Configuration">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Auth Server Configuration
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://www.eclipse.org/hono/admin-guide/device-registry-config/" title="Device Registry Configuration">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Device Registry Configuration
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>






			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/www.eclipse.org\/hono\/';
      var repo_id  = 'eclipse\/hono';
    
    </script>

    <script src="https://www.eclipse.org/hono/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            if(!headers[i].id)
                a.setAttribute("href", headers[i].parentNode.href);
            else
                a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    
      
      <script>
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-5WLCZXC');
      </script>
    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

