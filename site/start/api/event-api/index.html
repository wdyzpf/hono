<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Event API - Eclipse Hono</title>
    <meta name="generator" content="Hugo 0.42" />

    
    <meta name="description" content="A set of micro-services for connecting millions of devices.">
    
    <link rel="canonical" href="https://www.eclipse.org/hono/api/event-api/">
    
    <meta name="author" content="The Eclipse Hono Project">
    

    <meta property="og:url" content="https://www.eclipse.org/hono/api/event-api/">
    <meta property="og:title" content="Eclipse Hono">
    <meta property="og:image" content="https://www.eclipse.org/hono/images/logo-32x32px.png">
    <meta name="apple-mobile-web-app-title" content="Eclipse Hono">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://www.eclipse.org/hono/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://www.eclipse.org/hono/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://www.eclipse.org/hono/fonts/icon.eot');
        src: url('https://www.eclipse.org/hono/fonts/icon.eot')
               format('embedded-opentype'),
             url('https://www.eclipse.org/hono/fonts/icon.woff')
               format('woff'),
             url('https://www.eclipse.org/hono/fonts/icon.ttf')
               format('truetype'),
             url('https://www.eclipse.org/hono/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://www.eclipse.org/hono/stylesheets/application.css">
    <link rel="stylesheet" href="https://www.eclipse.org/hono/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://www.eclipse.org/hono/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://www.eclipse.org/hono/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <link rel="stylesheet" href="https://www.eclipse.org/hono/css/hono.css">
    
    <link rel="stylesheet" href="//www.eclipse.org/eclipse.org-common/themes/solstice/public/stylesheets/vendor/cookieconsent/cookieconsent.min.css">
    
    <script src="https://www.eclipse.org/hono/javascripts/modernizr.js"></script>
    <script src="//www.eclipse.org/eclipse.org-common/themes/solstice/public/javascript/vendor/cookieconsent/default.min.js"></script>

    

  </head>
  <body class="palette-primary-orange palette-accent-teal">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Event API
      </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/eclipse/hono" title="@eclipse/hono on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://www.eclipse.org/hono/" class="project">
    <div class="banner">
      
        <div class="drawerlogo">
          <img src="https://www.eclipse.org/hono/images/logo-32x32px.png">
        </div>
      
      <div class="name">
        <strong>Eclipse Hono&trade; </strong>
        
          <br>
          eclipse/hono
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="https://www.eclipse.org/hono/download/" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/eclipse/hono/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Getting started" href="/hono/getting-started/">
	
	Getting started
</a>



  
</li>



<li>
  
    



<a  title="Downloads" href="/hono/download/">
	
	Downloads
</a>



  
</li>



<li>
  
    



<a  title="Sandbox" href="/hono/sandbox/">
	
	Sandbox
</a>



  
</li>



<li>
  
    



<a  title="Concepts" href="/hono/concepts/">
	
	Concepts
</a>



  
</li>



<li>
  
    



<a  title="User Guide" href="/hono/user-guide/">
	
	User Guide
</a>



  
</li>



<li>
  
    



<a  title="Admin Guide" href="/hono/admin-guide/">
	
	Admin Guide
</a>



  
</li>



<li>
  
    



<a  title="Developer Guide" href="/hono/dev-guide/">
	
	Developer Guide
</a>



  
</li>



<li>
  
    



<a  title="API" href="/hono/api/">
	
	API
</a>



  
</li>



<li>
  
    



<a  title="Deployment" href="/hono/deployment/">
	
	Deployment
</a>



  
</li>



<li>
  
    



<a  title="Architecture" href="/hono/architecture/">
	
	Architecture
</a>



  
</li>



<li>
  
    



<a  title="Community" href="/hono/community/">
	
	Community
</a>



  
</li>



<li>
  
    



<a  title="License" href="/hono/license/">
	
	License
</a>



  
</li>


        </ul>
        

        
        <hr>
        <span class="section">Build Status:</span>

        <ul>
          
          <li>
            <a href="https://ci.eclipse.org/hono/job/Hono-CI/" title="Eclipse Build Status" target="_blank">
              <img src="https://ci.eclipse.org/hono/buildStatus/icon?job=Hono-CI">
            </a>
          </li>
          

          <li>
            <a href="https://travis-ci.org/eclipse/hono" title="Travis Build Status" target="_blank">
              <img src="https://travis-ci.org/eclipse/hono.svg?branch=master" />
            </a>
          </li>
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Event API </h1>

			<p>The <em>Event</em> API is used by <em>Devices</em> to send event messages downstream.
<em>Business Applications</em> and other consumers use the API to receive messages published by devices belonging to a particular tenant.
</p>

<p>The Event API is defined by means of AMQP 1.0 message exchanges, i.e. a client needs to connect to Hono using AMQP 1.0 in order to invoke operations of the API as described in the following sections. Throughout the remainder of this page we will simply use <em>AMQP</em> when referring to AMQP 1.0.</p>

<p>The <em>Event</em> API is identical to the <a href="/hono/api/telemetry-api/"><em>Telemetry</em> API</a> regarding the provided operations and the message flow.</p>

<p>Events provide a different quality of service for messages sent to the <em>Event</em> endpoint by
setting the <em>durable</em> property of the message header to <code>true</code>.</p>

<p>There are well-known events that are distinguished by their <em>content-type</em> which are defined <a href="#well-known-event-message-types">here</a>.</p>

<h1 id="southbound-operations">Southbound Operations</h1>

<p>The following operations can be used by <em>Devices</em> and/or <em>Protocol Adapters</em> (to which the devices are connected) to publish event messages for consumption by downstream consumers like <em>Business Applications</em>.</p>

<p>Both <em>Devices</em> as well as <em>Protocol Adapters</em> will be referred to as <em>clients</em> in the remainder of this section.</p>

<h2 id="upload-event-data">Upload Event Data</h2>

<p><strong>Preconditions</strong></p>

<ol>
<li>Client has established an AMQP connection with Hono&rsquo;s Event endpoint.</li>
<li>Client has established an AMQP link in role <em>sender</em> with Hono using target address <code>event/${tenant_id}</code> where <code>${tenant_id}</code> is the ID of the tenant that the client wants to upload event messages for.</li>
<li>The device for which the client wants to send an event has been registered (see <a href="/hono/api/device-registration-api/">Device Registration API</a>).</li>
<li>Client has obtained a <em>registration assertion</em> for the device from the Device Registration service by means of the <a href="/hono/api/device-registration-api/#assert-device-registration">assert Device Registration operation</a>.</li>
</ol>

<p>Hono supports <em>AT LEAST ONCE</em> delivery of <em>Event</em> messages only. A client therefore MUST use <code>unsettled</code> for the <em>snd-settle-mode</em> and <code>first</code> for the <em>rcv-settle-mode</em> fields of its <em>attach</em> frame during link establishment. All other combinations are not supported by Hono and result in the termination of the link.</p>

<p><strong>Message Flow</strong></p>

<p>The following sequence diagram illustrates the flow of messages involved in the <em>MQTT Adapter</em> uploading an event data message to Hono Messaging&rsquo;s Event endpoint.</p>

<p><img src="../uploadEvent_Success.png" alt="Upload event data flow" /></p>

<ol>
<li><em>MQTT Adapter</em> sends event data for device <code>4711</code>.

<ol>
<li><em>Hono Messaging</em> successfully verifies that device <code>4711</code> of <code>TENANT</code> exists and is enabled by means of validating the <em>registration assertion</em> included in the message (see <a href="/hono/api/device-registration-api/#assert-device-registration">Device Registration</a>) and forwards data to <em>AMQP 1.0 Messaging Network</em>.</li>
</ol></li>
<li><em>AMQP 1.0 Messaging Network</em> acknowledges reception of the message.

<ol>
<li><em>Hono Messaging</em> acknowledges reception of the message. In contrast to telemetry data, the protocol adapter awaits the disposition from the AMQP 1.0 Messaging Network before signaling to the device that it has accepted the message for processing.<br />
<br /></li>
</ol></li>
</ol>

<p><strong>Message Format</strong></p>

<p>See <a href="/hono/api/telemetry-api/#upload-telemetry-data">Telemetry API</a> for definition of message format.</p>

<p>Note that Hono does not return any <em>application layer</em> message back to the client in order to signal the outcome of the operation. Instead, Hono signals reception of the message by means of the AMQP <code>ACCEPTED</code> outcome if the message complies with the formal requirements and the downstream AMQP 1.0 messaging network has also <em>accepted</em> the event. Note that it depends on the configuration of the messaging network what <em>accepted</em> actually means. By default, event messages are marked as <em>durable</em> and the messaging network will thus at least have persisted the event successfully when it signals the <code>ACCEPTED</code> outcome to Hono.</p>

<p>Whenever a client sends an event that cannot be processed because it does not conform to the message format defined above, Hono settles the message transfer using the AMQP <code>REJECTED</code> outcome containing an <code>amqp:decode-error</code>. Clients <strong>should not</strong> try to re-send such rejected messages unaltered.</p>

<p>If the event passes formal verification, the outcome signaled to the client is the one received from the downstream AMQP 1.0 messaging network. In this case, clients may try to re-send messages for which a delivery state other than <code>ACCEPTED</code> has been returned.</p>

<h1 id="northbound-operations">Northbound Operations</h1>

<h2 id="receive-event-data">Receive Event Data</h2>

<p>Hono delivers messages containing event messages reported by a particular device in the same order that they have been received in (using the <em>Events</em> operation defined above).
Hono supports multiple non-competing <em>Business Application</em> consumers of event messages for a given tenant. Hono allows each <em>Business Application</em> to have multiple competing consumers for event messages for a given tenant to share the load of processing the messages.</p>

<p><strong>Preconditions</strong></p>

<ol>
<li>Client has established an AMQP connection with Hono.</li>
<li>Client has established an AMQP link in role <em>receiver</em> with Hono using source address <code>event/${tenant_id}</code> where <code>${tenant_id}</code> represents the ID of the tenant the client wants to retrieve event messages for.</li>
</ol>

<p>Hono supports <em>AT LEAST ONCE</em> delivery of <em>Event</em> messages only. A client therefore MUST use <code>unsettled</code> for the <em>snd-settle-mode</em> and <code>first</code> for the <em>rcv-settle-mode</em> fields of its <em>attach</em> frame during link establishment. All other combinations are not supported by Hono and result in the termination of the link.</p>

<p><strong>Message Flow</strong></p>

<p>The following sequence diagram illustrates the flow of messages involved in a <em>Business Application</em> receiving an event data message from Hono.</p>

<p><img src="../consumeEvent_Success.png" alt="Receive event data flow" /></p>

<ol>
<li><em>AMQP 1.0 Messaging Network</em> delivers event message to <em>Business Application</em>.</li>
<li><em>Business Application</em> acknowledges reception of message.</li>
</ol>

<p><strong>Message Format</strong></p>

<p>See <a href="/hono/api/telemetry-api/"><em>Telemetry API</em></a> for definition of message format.</p>

<h1 id="well-known-event-message-types">Well-known event message types</h1>

<p>Hono defines <em>well-known</em> events that are of a specific <em>content-type</em>. In the following these events are specified in detail.</p>

<h2 id="empty-notification">Empty notification</h2>

<p>An event of this type does not have any payload so the body of the event MUST be empty (different from other messages sent downstream).
It only carries AMQP 1.0 properties.</p>

<p>The AMQP 1.0 properties an event sender needs to set for an <em>empty notification</em> event are defined in the <a href="/hono/api/telemetry-api/"><em>Telemetry API</em></a>.</p>

<p>The relevant properties are listed again in the following table:</p>

<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="center">Mandatory</th>
<th align="left">Location</th>
<th align="left">Type</th>
<th align="left">Description</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left"><em>content-type</em></td>
<td align="center">yes</td>
<td align="left"><em>properties</em></td>
<td align="left"><em>symbol</em></td>
<td align="left">Must be set to <em>application/vnd.eclipse-hono-empty-notification</em></td>
</tr>

<tr>
<td align="left"><em>ttd</em></td>
<td align="center">no</td>
<td align="left"><em>application-properties</em></td>
<td align="left"><em>int</em></td>
<td align="left">&lsquo;time till disconnect&rsquo; : see <a href="/hono/api/telemetry-api/"><em>Telemetry API</em></a>.</td>
</tr>
</tbody>
</table>

<p>NB: An empty notification can be used to indicate to a <em>Business Application</em> that a device is currently ready to receive an upstream message by setting the <em>ttd</em> property. The application receiving the notification can verify if the notification is not expired and then may decide to send an upstream message to the device.</p>

<h2 id="connection-events">Connection Events</h2>

<p>The internal connect/disconnect events may be translated into Hono Events with
a well known message format and type. As such they are injected into the normal
event message stream.</p>

<div class="admonition note">
<p class="admonition-title">Authenticated devices only</p>
<p>As the <em>Event</em> API requires a tenant in order to allow sending events, an
authenticated device is required. Internal events for unauthenticated devices
will be dropped by this implementation and not be delivered via the <em>Event</em> API.</p>
</div>

<p>The following table provides an overview of the message structure:</p>

<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="center">Mandatory</th>
<th align="left">Location</th>
<th align="left">Type</th>
<th align="left">Description</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left"><em>content-type</em></td>
<td align="center">yes</td>
<td align="left"><em>properties</em></td>
<td align="left"><em>symbol</em></td>
<td align="left">Must be set to  <em>application/vnd.eclipse-hono-dc-notification+json</em></td>
</tr>

<tr>
<td align="left"><em>device_id</em></td>
<td align="center">yes</td>
<td align="left"><em>application-properties</em></td>
<td align="left"><em>string</em></td>
<td align="left">The ID of the authenticated device</td>
</tr>
</tbody>
</table>

<p>The payload is a JSON object with the following fields:</p>

<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="center">Mandatory</th>
<th align="left">Type</th>
<th align="left">Description</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left"><em>cause</em></td>
<td align="center">yes</td>
<td align="left"><em>string</em></td>
<td align="left">The cause of the connection event. Must be either <em>connected</em> or <em>disconnected</em>.</td>
</tr>

<tr>
<td align="left"><em>remote-id</em></td>
<td align="center">yes</td>
<td align="left"><em>string</em></td>
<td align="left">The ID of the remote endpoint which connected (e.g. a remote address, port, client id, &hellip;). This is specific to the protocol adapter.</td>
</tr>

<tr>
<td align="left"><em>source</em></td>
<td align="center">yes</td>
<td align="left"><em>string</em></td>
<td align="left">The name of the protocol adapter. e.g. <em>hono-mqtt</em>.</td>
</tr>

<tr>
<td align="left"><em>data</em></td>
<td align="center">no</td>
<td align="left"><em>object</em></td>
<td align="left">An arbitrary JSON object which may contain additional information from the protocol adapter.</td>
</tr>
</tbody>
</table>

<p>Below is an example for a connection event:</p>

<pre><code class="language-json">{
  &quot;cause&quot;: &quot;connect&quot;,
  &quot;remote-id&quot;: &quot;mqtt-client-id-1&quot;,
  &quot;source&quot;: &quot;hono-mqtt&quot;,
  &quot;data&quot;: {
    &quot;foo&quot;: &quot;bar&quot;
  }
}
</code></pre>

      <aside class="copyright" role="note">
  <div class="logo">
    <a href="https://www.eclipse.org" target="_blank">
      <img src="https://www.eclipse.org/hono/images/eclipse_foundation_logo.png" />
    </a>
  </div>
  <p class="notice">
    
    &copy; 2018 The Eclipse Hono Project &ndash;
    
    Documentation built with
    <a href="https://www.gohugo.io" target="_blank">Hugo</a>
    using the
    <a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
  </p>
  <p class="quickLinks">
    <a href="http://www.eclipse.org/legal/privacy.php" target="_blank">
      &gt; Privacy Policy
    </a>
    <a href="http://www.eclipse.org/legal/termsofuse.php" target="_blank">
      &gt; Terms of Use
    </a>
    <a href="http://www.eclipse.org/legal/copyright.php" target="_blank">
      &gt; Copyright Agent
    </a>
    <a href="http://www.eclipse.org/legal" target="_blank">
      &gt; Legal
    </a>
    <a href="https://eclipse.org/security" target="_blank">
      &gt; Report a Vulnerability
    </a>
  </p>
</aside>


			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://www.eclipse.org/hono/api/telemetry-api/" title="Telemetry API">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Telemetry API
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://www.eclipse.org/hono/api/credentials-api/" title="Credentials API">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Credentials API
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>






			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/www.eclipse.org\/hono\/';
      var repo_id  = 'eclipse\/hono';
    
    </script>

    <script src="https://www.eclipse.org/hono/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            if(!headers[i].id)
                a.setAttribute("href", headers[i].parentNode.href);
            else
                a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    
      
      <script>
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-5WLCZXC');
      </script>
    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

