<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Kubernetes - Eclipse Hono</title>
    <meta name="generator" content="Hugo 0.42" />

    
    <meta name="description" content="A set of micro-services for connecting millions of devices.">
    
    <link rel="canonical" href="https://www.eclipse.org/hono/deployment/kubernetes/">
    
    <meta name="author" content="The Eclipse Hono Project">
    

    <meta property="og:url" content="https://www.eclipse.org/hono/deployment/kubernetes/">
    <meta property="og:title" content="Eclipse Hono">
    <meta property="og:image" content="https://www.eclipse.org/hono/images/logo-32x32px.png">
    <meta name="apple-mobile-web-app-title" content="Eclipse Hono">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://www.eclipse.org/hono/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://www.eclipse.org/hono/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://www.eclipse.org/hono/fonts/icon.eot');
        src: url('https://www.eclipse.org/hono/fonts/icon.eot')
               format('embedded-opentype'),
             url('https://www.eclipse.org/hono/fonts/icon.woff')
               format('woff'),
             url('https://www.eclipse.org/hono/fonts/icon.ttf')
               format('truetype'),
             url('https://www.eclipse.org/hono/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://www.eclipse.org/hono/stylesheets/application.css">
    <link rel="stylesheet" href="https://www.eclipse.org/hono/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://www.eclipse.org/hono/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://www.eclipse.org/hono/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <link rel="stylesheet" href="https://www.eclipse.org/hono/css/hono.css">
    
    <link rel="stylesheet" href="//www.eclipse.org/eclipse.org-common/themes/solstice/public/stylesheets/vendor/cookieconsent/cookieconsent.min.css">
    
    <script src="https://www.eclipse.org/hono/javascripts/modernizr.js"></script>
    <script src="//www.eclipse.org/eclipse.org-common/themes/solstice/public/javascript/vendor/cookieconsent/default.min.js"></script>

    

  </head>
  <body class="palette-primary-orange palette-accent-teal">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Kubernetes
      </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/eclipse/hono" title="@eclipse/hono on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://www.eclipse.org/hono/" class="project">
    <div class="banner">
      
        <div class="drawerlogo">
          <img src="https://www.eclipse.org/hono/images/logo-32x32px.png">
        </div>
      
      <div class="name">
        <strong>Eclipse Hono&trade; </strong>
        
          <br>
          eclipse/hono
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="https://www.eclipse.org/hono/download/" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/eclipse/hono/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Getting started" href="/hono/getting-started/">
	
	Getting started
</a>



  
</li>



<li>
  
    



<a  title="Downloads" href="/hono/download/">
	
	Downloads
</a>



  
</li>



<li>
  
    



<a  title="Sandbox" href="/hono/sandbox/">
	
	Sandbox
</a>



  
</li>



<li>
  
    



<a  title="Concepts" href="/hono/concepts/">
	
	Concepts
</a>



  
</li>



<li>
  
    



<a  title="User Guide" href="/hono/user-guide/">
	
	User Guide
</a>



  
</li>



<li>
  
    



<a  title="Admin Guide" href="/hono/admin-guide/">
	
	Admin Guide
</a>



  
</li>



<li>
  
    



<a  title="Developer Guide" href="/hono/dev-guide/">
	
	Developer Guide
</a>



  
</li>



<li>
  
    



<a  title="API" href="/hono/api/">
	
	API
</a>



  
</li>



<li>
  
    



<a  title="Deployment" href="/hono/deployment/">
	
	Deployment
</a>



  
</li>



<li>
  
    



<a  title="Architecture" href="/hono/architecture/">
	
	Architecture
</a>



  
</li>



<li>
  
    



<a  title="Community" href="/hono/community/">
	
	Community
</a>



  
</li>



<li>
  
    



<a  title="License" href="/hono/license/">
	
	License
</a>



  
</li>


        </ul>
        

        
        <hr>
        <span class="section">Build Status:</span>

        <ul>
          
          <li>
            <a href="https://ci.eclipse.org/hono/job/Hono-CI/" title="Eclipse Build Status" target="_blank">
              <img src="https://ci.eclipse.org/hono/buildStatus/icon?job=Hono-CI">
            </a>
          </li>
          

          <li>
            <a href="https://travis-ci.org/eclipse/hono" title="Travis Build Status" target="_blank">
              <img src="https://travis-ci.org/eclipse/hono.svg?branch=master" />
            </a>
          </li>
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Kubernetes </h1>

			<p>All the Eclipse Hono&trade; components can be deployed on Kubernetes, thanks to the resources YAML files that are provided through the repository.
These files describe such components in terms of <em>deployments</em> and <em>services</em> in order to have the right pods running in the Kubernetes cluster so that they are able
to communicate with each other.
</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>The main prerequisite for this kind of deployment is to have an available Kubernetes cluster. For a local development, it&rsquo;s pretty simple having such cluster using Minikube
which is a tool that helps you run Kubernetes locally by running a single-node Kubernetes cluster inside a VM. Follow <a href="https://kubernetes.io/docs/getting-started-guides/minikube/">this guide</a>
for installing and having Minikube up and running.</p>

<p>The other prerequisite is to have the Kubectl command line tool for interacting with the Kubernetes cluster. Follow <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">this guide</a>
for installing and configuring such a tool.</p>

<p>After launching Minikube and before building the Eclipse Hono images, it&rsquo;s necessary to execute the following command :</p>

<pre><code class="language-sh">$ eval $(minikube docker-env)
</code></pre>

<p>In this way, the <code>DOCKER_HOST</code> environment variable is set to the Docker daemon running inside the Minikube VM. Launching the following command for building the Eclipse Hono images,
such daemon will be used and the final images will be available inside the Minikube VM, ready for the deployment.</p>

<pre><code class="language-sh">~/hono$ mvn clean install -Pbuild-docker-image
</code></pre>

<h2 id="script-based-deployment">Script based Deployment</h2>

<p>In order to deploy Eclipse Hono on Kubernetes, a bunch of steps are needed as explained in the next chapter. If you want to avoid to do them manually, a <em>one click</em> deployment
script is available in the repository.
After having the Kubernetes cluster up and running and the <code>kubectl</code> command line tool in the PATH, the deployment can be done by running the following bash script
(from the <code>example/target/deploy/kubernetes</code> directory)</p>

<pre><code class="language-sh">~hono/example/target/deploy/kubernetes$ chmod +x *.sh
~hono/example/target/deploy/kubernetes$ ./kubernetes_deploy.sh
</code></pre>

<p>In order to see the deployed components, you can launch Kubernetes&rsquo; web UI in a browser by issuing:</p>

<pre><code class="language-sh">$ minikube dashboard
</code></pre>

<p>Be sure to switch to the <code>hono</code> namespace in the UI in order to see the components deployed as part of Hono.
In the following pictures an Eclipse Hono deployment on Kubernetes is running with all the provided components.</p>

<p><img src="../kubernetes_hono.png" alt="Eclipse Hono on Kubernetes" /></p>

<h3 id="undeploying-hono">Undeploying Hono</h3>

<p>There also is a script for shutting down and undeploying Hono:</p>

<pre><code class="language-sh">~hono/example/target/deploy/kubernetes$ ./kubernetes_undeploy.sh
</code></pre>

<h2 id="deploying-individual-components">Deploying individual Components</h2>

<p>You may also deploy each of Hono&rsquo;s components separately by copying the relevant commands from the deploy script to your own script or entering them directly on the command line.</p>

<h2 id="accessing-hono-services">Accessing Hono Services</h2>

<p>The Kubernetes deployment provides access to Eclipse Hono by means of <em>services</em> and the main ones are:</p>

<ul>
<li><strong>hono-dispatch-router-ext</strong>: router network for the business application in order to consume data</li>
<li><strong>hono-adapter-mqtt-vertx</strong>: protocol adapter for publishing telemetry data and events using the MQTT protocol</li>
<li><strong>hono-adapter-rest-vertx</strong>: protocol adapter for publishing telemetry data and events using the HTTP protocol</li>
<li><strong>hono-service-device-registry</strong>: component for registering and managing devices</li>
</ul>

<p>You can check these services through the <code>kubectl get services --namespace hono</code> command having the following output :</p>

<pre><code class="language-sh">NAME                           CLUSTER-IP   EXTERNAL-IP   PORT(S)                                      AGE
grafana                        10.0.0.115   &lt;nodes&gt;       3000:31000/TCP                               15m
hono-adapter-mqtt-vertx        10.0.0.155   &lt;nodes&gt;       1883:31883/TCP,8883:30883/TCP                2m
hono-adapter-rest-vertx        10.0.0.184   &lt;nodes&gt;       8080:30080/TCP,8443:30443/TCP                3m
hono-artemis                   10.0.0.11    &lt;none&gt;        5672/TCP                                     6m
hono-dispatch-router           10.0.0.175   &lt;none&gt;        5673/TCP                                     5m
hono-dispatch-router-ext       10.0.0.124   &lt;nodes&gt;       5671:30671/TCP,5672:30672/TCP                5m
hono-service-auth              10.0.0.116   &lt;none&gt;        5671/TCP                                     5m
hono-service-device-registry   10.0.0.248   &lt;none&gt;        5671:31671/TCP,8080:31080/TCP,8443:31443/TCP 4m
hono-service-messaging         10.0.0.223   &lt;none&gt;        5671/TCP                                     3m
influxdb                       10.0.0.217   &lt;none&gt;        2003/TCP,8083/TCP,8086/TCP                   15m
</code></pre>

<p>These services are accessible using the Minikube VM&rsquo;s IP address (which you can get with the <code>minikube ip</code> command) and the so called <em>node ports</em> (i.e. 30080, 30671, &hellip;).
In the following sections the <code>$(minikube ip)</code> is used  in order to put the IP address of the Minikube VM into the command to execute.</p>

<h3 id="starting-a-consumer">Starting a Consumer</h3>

<p>As described in the <a href="/hono/getting-started/">Getting Started</a> guide, data produced by devices is usually consumed by downstream applications which connect directly to the router network service.
You can start the client from the <code>example</code> folder as follows:</p>

<pre><code class="language-sh">~/hono/example$ mvn spring-boot:run -Drun.arguments=--hono.client.host=$(minikube ip),--hono.client.port=30671,--hono.client.username=consumer@HONO,--hono.client.password=verysecret
</code></pre>

<h3 id="uploading-telemetry">Uploading Telemetry</h3>

<p>In order to upload telemetry data to Hono, the device needs to be registered with the system. You can register the device using the
<em>Device Registry</em> by running the following command (i.e. for a device with ID <code>4711</code>):</p>

<pre><code class="language-sh">$ curl -X POST -i -H 'Content-Type: application/json' --data-binary '{&quot;device-id&quot;: &quot;4711&quot;}' http://$(minikube ip):31080/registration/DEFAULT_TENANT
</code></pre>

<p>After having the device registered, uploading telemetry is just a simple HTTP POST command to the <em>HTTP Adapter</em>:</p>

<pre><code class="language-sh">$ curl -X POST -i -u sensor1@DEFAULT_TENANT:hono-secret -H 'Content-Type: application/json' --data-binary '{&quot;temp&quot;: 5}' http://$(minikube ip):30080/telemetry
</code></pre>

<p>Other than using the <em>HTTP Adapter</em>, it&rsquo;s possible to upload telemetry data using the <em>MQTT Adapter</em> as well:</p>

<pre><code class="language-sh">$ mosquitto_pub -h $(minikube ip) -p 31883 -u 'sensor1@DEFAULT_TENANT' -P hono-secret -t telemetry -m '{&quot;temp&quot;: 5}'
</code></pre>

<p>The username and password used above for device <code>4711</code> are part of the example configuration that comes with Hono. See <a href="/hono/concepts/device-identity/">Device Identity</a> for an explanation of how devices are identified in Hono and how device identity is related to authentication.</p>

      <aside class="copyright" role="note">
  <div class="logo">
    <a href="https://www.eclipse.org" target="_blank">
      <img src="https://www.eclipse.org/hono/images/eclipse_foundation_logo.png" />
    </a>
  </div>
  <p class="notice">
    
    &copy; 2018 The Eclipse Hono Project &ndash;
    
    Documentation built with
    <a href="https://www.gohugo.io" target="_blank">Hugo</a>
    using the
    <a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
  </p>
  <p class="quickLinks">
    <a href="http://www.eclipse.org/legal/privacy.php" target="_blank">
      &gt; Privacy Policy
    </a>
    <a href="http://www.eclipse.org/legal/termsofuse.php" target="_blank">
      &gt; Terms of Use
    </a>
    <a href="http://www.eclipse.org/legal/copyright.php" target="_blank">
      &gt; Copyright Agent
    </a>
    <a href="http://www.eclipse.org/legal" target="_blank">
      &gt; Legal
    </a>
    <a href="https://eclipse.org/security" target="_blank">
      &gt; Report a Vulnerability
    </a>
  </p>
</aside>


			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://www.eclipse.org/hono/api/command-and-control-api/" title="Command &amp; Control API">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Command &amp; Control API
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://www.eclipse.org/hono/deployment/openshift/" title="OpenShift with EnMasse">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              OpenShift with EnMasse
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>






			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/www.eclipse.org\/hono\/';
      var repo_id  = 'eclipse\/hono';
    
    </script>

    <script src="https://www.eclipse.org/hono/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            if(!headers[i].id)
                a.setAttribute("href", headers[i].parentNode.href);
            else
                a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    
      
      <script>
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-5WLCZXC');
      </script>
    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

