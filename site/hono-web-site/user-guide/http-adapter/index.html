<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>HTTP Adapter - Eclipse Hono</title>
    <meta name="generator" content="Hugo 0.42" />

    
    <meta name="description" content="A set of micro-services for connecting millions of devices.">
    
    <link rel="canonical" href="https://www.eclipse.org/hono/user-guide/http-adapter/">
    
    <meta name="author" content="The Eclipse Hono Project">
    

    <meta property="og:url" content="https://www.eclipse.org/hono/user-guide/http-adapter/">
    <meta property="og:title" content="Eclipse Hono">
    <meta property="og:image" content="https://www.eclipse.org/hono/images/logo-32x32px.png">
    <meta name="apple-mobile-web-app-title" content="Eclipse Hono">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://www.eclipse.org/hono/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://www.eclipse.org/hono/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://www.eclipse.org/hono/fonts/icon.eot');
        src: url('https://www.eclipse.org/hono/fonts/icon.eot')
               format('embedded-opentype'),
             url('https://www.eclipse.org/hono/fonts/icon.woff')
               format('woff'),
             url('https://www.eclipse.org/hono/fonts/icon.ttf')
               format('truetype'),
             url('https://www.eclipse.org/hono/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://www.eclipse.org/hono/stylesheets/application.css">
    <link rel="stylesheet" href="https://www.eclipse.org/hono/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://www.eclipse.org/hono/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://www.eclipse.org/hono/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <link rel="stylesheet" href="https://www.eclipse.org/hono/css/hono.css">
    
    <link rel="stylesheet" href="//www.eclipse.org/eclipse.org-common/themes/solstice/public/stylesheets/vendor/cookieconsent/cookieconsent.min.css">
    
    <script src="https://www.eclipse.org/hono/javascripts/modernizr.js"></script>
    <script src="//www.eclipse.org/eclipse.org-common/themes/solstice/public/javascript/vendor/cookieconsent/default.min.js"></script>

    

  </head>
  <body class="palette-primary-orange palette-accent-teal">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        HTTP Adapter
      </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/eclipse/hono" title="@eclipse/hono on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://www.eclipse.org/hono/" class="project">
    <div class="banner">
      
        <div class="drawerlogo">
          <img src="https://www.eclipse.org/hono/images/logo-32x32px.png">
        </div>
      
      <div class="name">
        <strong>Eclipse Hono&trade; </strong>
        
          <br>
          eclipse/hono
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="https://www.eclipse.org/hono/download/" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/eclipse/hono/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Getting started" href="/hono/getting-started/">
	
	Getting started
</a>



  
</li>



<li>
  
    



<a  title="Downloads" href="/hono/download/">
	
	Downloads
</a>



  
</li>



<li>
  
    



<a  title="Sandbox" href="/hono/sandbox/">
	
	Sandbox
</a>



  
</li>



<li>
  
    



<a  title="Concepts" href="/hono/concepts/">
	
	Concepts
</a>



  
</li>



<li>
  
    



<a  title="User Guide" href="/hono/user-guide/">
	
	User Guide
</a>



  
</li>



<li>
  
    



<a  title="Admin Guide" href="/hono/admin-guide/">
	
	Admin Guide
</a>



  
</li>



<li>
  
    



<a  title="Developer Guide" href="/hono/dev-guide/">
	
	Developer Guide
</a>



  
</li>



<li>
  
    



<a  title="API" href="/hono/api/">
	
	API
</a>



  
</li>



<li>
  
    



<a  title="Deployment" href="/hono/deployment/">
	
	Deployment
</a>



  
</li>



<li>
  
    



<a  title="Architecture" href="/hono/architecture/">
	
	Architecture
</a>



  
</li>



<li>
  
    



<a  title="Community" href="/hono/community/">
	
	Community
</a>



  
</li>



<li>
  
    



<a  title="License" href="/hono/license/">
	
	License
</a>



  
</li>


        </ul>
        

        
        <hr>
        <span class="section">Build Status:</span>

        <ul>
          
          <li>
            <a href="https://ci.eclipse.org/hono/job/Hono-CI/" title="Eclipse Build Status" target="_blank">
              <img src="https://ci.eclipse.org/hono/buildStatus/icon?job=Hono-CI">
            </a>
          </li>
          

          <li>
            <a href="https://travis-ci.org/eclipse/hono" title="Travis Build Status" target="_blank">
              <img src="https://travis-ci.org/eclipse/hono.svg?branch=master" />
            </a>
          </li>
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>HTTP Adapter </h1>

			<p>The HTTP protocol adapter exposes an HTTP based API for Eclipse Hono&trade;&rsquo;s Telemetry and Event endpoints.
</p>

<h2 id="device-authentication">Device Authentication</h2>

<p>The HTTP adapter by default requires clients (devices or gateway components) to authenticate during connection establishment. The adapter supports both the <a href="https://tools.ietf.org/html/rfc7617">Basic HTTP authentication scheme</a> as well as client certificate based authentication as part of a TLS handshake for that purpose.</p>

<p>The adapter tries to authenticate the device using these mechanisms in the following order</p>

<h3 id="client-certificate">Client Certificate</h3>

<p>When a device uses a client certificate for authentication during the TLS handshake, the adapter tries to determine the tenant that the device belongs to, based on the <em>issuer DN</em> contained in the certificate. In order for the lookup to succeed, the tenant&rsquo;s trust anchor needs to be configured by means of <a href="/hono/api/tenant-api/#request-payload">registering the trusted certificate authority</a>. The device&rsquo;s client certificate will then be validated using the registered trust anchor, thus implicitly establishing the tenant that the device belongs to. In a second step, the adapter then uses the Credentials API&rsquo;s <em>get</em> operation with the client certificate&rsquo;s <em>subject DN</em> and <code>x509-cert</code> as the <em>type</em> of secret as query parameters.</p>

<p>NB: The HTTP adapter needs to be <a href="/hono/admin-guide/secure_communication/#http-adapter">configured for TLS</a> in order to support this mechanism.</p>

<h3 id="http-basic-auth">HTTP Basic Auth</h3>

<p>The <em>username</em> provided in the header must have the form <em>auth-id@tenant</em>, e.g. <code>sensor1@DEFAULT_TENANT</code>. The adapter verifies the credentials provided by the client against the credentials that the <a href="/hono/admin-guide/http-adapter-config/#credentials-service-configuration">configured Credentials service</a> has on record for the client. The adapter uses the Credentials API&rsquo;s <em>get</em> operation to retrieve the credentials on record with the <em>tenant</em> and <em>auth-id</em> provided by the device in the <em>username</em> and <code>hashed-password</code> as the <em>type</em> of secret as query parameters.</p>

<p>When running the Hono example installation as described in the <a href="/hono/getting-started/">Getting Started guide</a>, the demo Credentials service comes pre-configured with a <code>hashed-password</code> secret for devices <code>4711</code> and <code>gw-1</code> of tenant <code>DEFAULT_TENANT</code> having <em>auth-ids</em> <code>sensor1</code> and <code>gw1</code> and (hashed) <em>passwords</em> <code>hono-secret</code> and <code>gw-secret</code> respectively. These credentials are used in the following examples illustrating the usage of the adapter. Please refer to the <a href="/hono/api/credentials-api/#standard-credential-types">Credentials API</a> for details regarding the different types of secrets.</p>

<p>NB: There is a subtle difference between the <em>device identifier</em> (<em>device-id</em>) and the <em>auth-id</em> a device uses for authentication. See <a href="/hono/concepts/device-identity/">Device Identity</a> for a discussion of the concepts.</p>

<h2 id="publish-telemetry-data-authenticated-device">Publish Telemetry Data (authenticated Device)</h2>

<ul>
<li>URI: <code>/telemetry</code></li>
<li>Method: <code>POST</code></li>
<li>Request Headers:

<ul>
<li>(optional) <code>Authorization</code>: The device&rsquo;s <em>auth-id</em> and plain text password encoded according to the <a href="https://tools.ietf.org/html/rfc7617">Basic HTTP authentication scheme</a>. If not set, the adapter expects the device to present a client certificate as part of the TLS handshake during connection establishment.</li>
<li>(required) <code>Content-Type</code>: The type of payload contained in the body.</li>
<li>(optional) <code>hono-ttd</code>: The number of seconds the device will wait for the response.</li>
<li>(optional) <code>QoS-Level</code>: The QoS level for publishing telemetry messages. Only QoS 1 is supported by the adapter.</li>
</ul></li>
<li>Request Body:

<ul>
<li>(required) Arbitrary payload encoded according to the given content type.</li>
</ul></li>
<li>Status Codes:

<ul>
<li>202 (Accepted): The telemetry data has been accepted for processing. Note that if the <code>QoS-Level</code> request header is missing, the adapter does not <em>guarantee</em> successful delivery to potential consumers.
However, if the QoS-Level header is set to <code>AT_LEAST_ONCE(1)</code>, then the adapter waits for the message to be delivered and accepted by a downstream peer before responding with a 202 status code to the device.</li>
<li>400 (Bad Request): The request cannot be processed. Possible reasons for this might be that:

<ul>
<li>The content type header is missing.</li>
<li>The request body is empty.</li>
<li>The QoS header value is invalid.</li>
</ul></li>
<li>401 (Unauthorized): The request cannot be processed because the request does not contain valid credentials.</li>
<li>403 (Forbidden): The request cannot be processed because the device&rsquo;s registration status cannot be asserted. Possible reasons for this might be:

<ul>
<li>The given tenant is not allowed to use this protocol adapter.</li>
<li>The given device is disabled.</li>
</ul></li>
<li>503 (Service Unavailable): The request cannot be processed because there is no consumer of telemetry data for the given tenant connected to Hono.</li>
</ul></li>
</ul>

<p>This is the preferred way for devices to publish telemetry data. It is available only if the protocol adapter is configured to require devices to authenticate (which is the default).</p>

<p><strong>Examples</strong></p>

<p>Publish some JSON data for device <code>4711</code>:</p>

<pre><code>$ curl -i -X POST -u sensor1@DEFAULT_TENANT:hono-secret -H 'Content-Type: application/json' \
$ --data-binary '{&quot;temp&quot;: 5}' http://127.0.0.1:8080/telemetry

HTTP/1.1 202 Accepted
Content-Length: 0
</code></pre>

<p>Publish some JSON data for device <code>4711</code> using QoS level <code>AT_LEAST_ONCE</code>:</p>

<pre><code>$ curl -i -X POST -u sensor1@DEFAULT_TENANT:hono-secret -H 'Content-Type: application/json' -H 'QoS-Level: 1' \
$ --data-binary '{&quot;temp&quot;: 5}' http://localhost:8080/telemetry

HTTP/1.1 202 Accepted
Content-Length: 0
</code></pre>

<p>Publish some JSON data for device <code>4711</code> using an invalid QoS level:</p>

<pre><code>$ curl -i -X POST -u sensor1@DEFAULT_TENANT:hono-secret -H 'Content-Type: application/json' -H 'QoS-Level: 2' \
$ --data-binary '{&quot;temp&quot;: 5}' http://localhost:8080/telemetry

HTTP/1.1 400 Bad QoS Header Value
Content-Length: 20
</code></pre>

<h2 id="publish-telemetry-data-unauthenticated-device">Publish Telemetry Data (unauthenticated Device)</h2>

<ul>
<li>URI: <code>/telemetry/${tenantId}/${deviceId}</code></li>
<li>Method: <code>PUT</code></li>
<li>Request Headers:

<ul>
<li>(required) <code>Content-Type</code>: The type of payload contained in the body.</li>
<li>(optional) <code>hono-ttd</code>: The number of seconds the device will wait for the response.</li>
<li>(optional) <code>QoS-Level</code>: The QoS level for publishing telemetry messages. Only QoS 1 is supported by the adapter.</li>
</ul></li>
<li>Request Body:

<ul>
<li>(required) Arbitrary payload encoded according to the given content type.</li>
</ul></li>
<li>Status Codes:

<ul>
<li>202 (Accepted): The telemetry data has been accepted for processing. Note that if the <code>QoS-Level</code> request header is missing, the adapter does not <em>guarantee</em> successful delivery to potential consumers.
However, if the QoS-Level header is set to <code>AT_LEAST_ONCE(1)</code>, then the adapter waits for the message to be delivered and accepted by a downstream peer before responding with a 202 status code to the device.</li>
<li>400 (Bad Request): The request cannot be processed. Possible reasons for this might be that:

<ul>
<li>The content type header is missing.</li>
<li>The request body is empty.</li>
<li>The QoS header value is invalid.</li>
</ul></li>
<li>403 (Forbidden): The request cannot be processed because the device&rsquo;s registration status cannot be asserted. Possible reasons for this might be:

<ul>
<li>The given tenant is not allowed to use this protocol adapter.</li>
<li>The given device does not belong to the given tenant.</li>
<li>The given device is disabled.</li>
</ul></li>
<li>503 (Service Unavailable): The request cannot be processed because there is no consumer of telemetry data for the given tenant connected to Hono.</li>
</ul></li>
</ul>

<p>This resource MUST be used by devices that have not authenticated to the protocol adapter. Note that this requires the <code>HONO_HTTP_AUTHENTICATION_REQUIRED</code> configuration property to be explicitly set to <code>false</code>.</p>

<p><strong>Examples</strong></p>

<p>Publish some JSON data for device <code>4711</code>:</p>

<pre><code>$ curl -i -X PUT -H 'Content-Type: application/json' \
$ --data-binary '{&quot;temp&quot;: 5}' http://127.0.0.1:8080/telemetry/DEFAULT_TENANT/4711

HTTP/1.1 202 Accepted
Content-Length: 0
</code></pre>

<p>Publish some JSON data for device <code>4711</code> using QoS level <code>AT_LEAST_ONCE</code>:</p>

<pre><code>$ curl -i -X PUT -H 'Content-Type: application/json' -H 'QoS-Level: 1' \
$ --data-binary '{&quot;temp&quot;: 5}' http://127.0.0.1:8080/telemetry/DEFAULT_TENANT/4711

HTTP/1.1 202 Accepted
Content-Length: 0
</code></pre>

<p>Publish some JSON data for device <code>4711</code> using an invalid QoS level:</p>

<pre><code>$ curl -i -X PUT -H 'Content-Type: application/json' -H 'QoS-Level: 2' \
$ --data-binary '{&quot;temp&quot;: 5}' http://127.0.0.1:8080/telemetry/DEFAULT_TENANT/4711

HTTP/1.1 400 Bad QoS Header Value
Content-Length: 20
</code></pre>

<h2 id="publish-telemetry-data-authenticated-gateway">Publish Telemetry Data (authenticated Gateway)</h2>

<ul>
<li>URI: <code>/telemetry/${tenantId}/${deviceId}</code></li>
<li>Method: <code>PUT</code></li>
<li>Request Headers:

<ul>
<li>(optional) <code>Authorization</code>: The gateway&rsquo;s <em>auth-id</em> and plain text password encoded according to the <a href="https://tools.ietf.org/html/rfc7617">Basic HTTP authentication scheme</a>. If not set, the adapter expects the gateway to present a client certificate as part of the TLS handshake during connection establishment.</li>
</ul></li>
<li>Request Headers:

<ul>
<li>(required) <code>Content-Type</code>: The type of payload contained in the body.</li>
<li>(optional) <code>hono-ttd</code>: The number of seconds the device will wait for the response.</li>
<li>(optional) <code>QoS-Level</code>: The QoS level for publishing telemetry messages. Only QoS 1 is supported by the adapter.</li>
</ul></li>
<li>Request Body:

<ul>
<li>(required) Arbitrary payload encoded according to the given content type.</li>
</ul></li>

<li><p>Status Codes:</p>

<ul>
<li>202 (Accepted): The telemetry data has been accepted for processing. Note that if the <code>QoS-Level</code> request header is missing, the adapter does not <em>guarantee</em> successful delivery to potential consumers.
However, if the QoS-Level header is set to <code>AT_LEAST_ONCE(1)</code>, then the adapter waits for the message to be delivered and accepted by a downstream peer before responding with a 202 status code to the device.</li>
<li>400 (Bad Request): The request cannot be processed. Possible reasons for this might be that:

<ul>
<li>The content type header is missing</li>
<li>The request body is empty</li>
<li>The QoS header value is invalid</li>
</ul></li>

<li><p>403 (Forbidden): The request cannot be processed because the device&rsquo;s registration status cannot be asserted. Possible reasons for this might be:</p>

<ul>
<li>The given tenant is not allowed to use this protocol adapter.</li>
<li>The given device does not belong to the given tenant.</li>
<li>The given device is disabled.</li>
</ul></li>

<li><p>503 (Service Unavailable): The request cannot be processed because there is no consumer of telemetry data for the given tenant connected to Hono.</p></li>
</ul></li>
</ul>

<p>This resource can be used by <em>gateway</em> components to publish data <em>on behalf of</em> other devices which do not connect to a protocol adapter directly but instead are connected to the gateway, e.g. using some low-bandwidth radio based technology like <a href="https://www.sigfox.com">SigFox</a> or <a href="https://www.lora-alliance.org/">LoRa</a>. In this case the credentials provided by the gateway during connection establishment with the protocol adapter are used to authenticate the gateway whereas the parameters from the URI are used to identify the device that the gateway publishes data for.</p>

<p>The protocol adapter checks the gateway&rsquo;s authority to publish data on behalf of the device implicitly by means of retrieving a <em>registration assertion</em> for the device from the <a href="#device-registration-service-connection-configuration">configured Device Registration service</a>.</p>

<p><strong>Examples</strong></p>

<p>Publish some JSON data for device <code>4712</code> via gateway <code>gw-1</code>:</p>

<pre><code>$ curl -i -X PUT -u gw@DEFAULT_TENANT:gw-secret -H 'Content-Type: application/json' \
$ --data-binary '{&quot;temp&quot;: 5}' http://127.0.0.1:8080/telemetry/DEFAULT_TENANT/4712

HTTP/1.1 202 Accepted
Content-Length: 0
</code></pre>

<p>Publish some JSON data for device <code>4712</code> using QoS level <code>AT_LEAST_ONCE</code>:</p>

<pre><code>$ curl -i -X PUT -u gw@DEFAULT_TENANT:gw-secret -H 'Content-Type: application/json' -H 'QoS-Level: 1' \
$ --data-binary '{&quot;temp&quot;: 5}' http://127.0.0.1:8080/telemetry/DEFAULT_TENANT/4712

HTTP/1.1 202 Accepted
Content-Length: 0
</code></pre>

<p>Publish some JSON data for device <code>4712</code> using an invalid QoS level:</p>

<pre><code>$ curl -i -X POST -u gw@DEFAULT_TENANT:gw-secret -H 'Content-Type: application/json' -H 'QoS-Level: 2' \
$ --data-binary '{&quot;temp&quot;: 5}' http://localhost:8080/telemetry/DEFAULT_TENANT/4712

HTTP/1.1 400 Bad QoS Header Value
Content-Length: 20
</code></pre>

<p><strong>NB</strong>: The example above assumes that a gateway device with ID <code>gw-1</code> has been registered with <code>hashed-password</code> credentials with <em>auth-id</em> <code>gw</code> and password <code>gw-secret</code>.</p>

<h2 id="publish-an-event-authenticated-device">Publish an Event (authenticated Device)</h2>

<ul>
<li>URI: <code>/event</code></li>
<li>Method: <code>POST</code></li>
<li>Request Headers:

<ul>
<li>(optional) <code>Authorization</code>: The device&rsquo;s <em>auth-id</em> and plain text password encoded according to the <a href="https://tools.ietf.org/html/rfc7617">Basic HTTP authentication scheme</a>. If not set, the adapter expects the device to present a client certificate as part of the TLS handshake during connection establishment.</li>
<li>(required) <code>Content-Type</code>: The type of payload contained in the body.</li>
<li>(optional) <code>hono-ttd</code>: The number of seconds the device will wait for the response.</li>
</ul></li>
<li>Request Body:

<ul>
<li>(required) Arbitrary payload encoded according to the given content type.</li>
</ul></li>
<li>Status Codes:

<ul>
<li>202 (Accepted): The event has been accepted and put to a persistent store for delivery to consumers.</li>
<li>400 (Bad Request): The request cannot be processed because the content type header is missing or the request body is empty.</li>
<li>401 (Unauthorized): The request cannot be processed because the request does not contain valid credentials.</li>
<li>403 (Forbidden): The request cannot be processed because the device&rsquo;s registration status cannot be asserted. Possible reasons for this might be:

<ul>
<li>The given tenant is not allowed to use this protocol adapter.</li>
<li>The given device is disabled.</li>
</ul></li>
<li>503 (Service Unavailable): The request cannot be processed because there is no consumer of events for the given tenant connected to Hono.</li>
</ul></li>
</ul>

<p>This is the preferred way for devices to publish events. It is available only if the protocol adapter is configured to require devices to authenticate (which is the default).</p>

<p><strong>Example</strong></p>

<p>Publish some JSON data for device <code>4711</code>:</p>

<pre><code>$ curl -i -X POST -u sensor1@DEFAULT_TENANT:hono-secret -H 'Content-Type: application/json' \
$ --data-binary '{&quot;alarm&quot;: true}' http://127.0.0.1:8080/event

HTTP/1.1 202 Accepted
Content-Length: 0
</code></pre>

<h2 id="publish-an-event-unauthenticated-device">Publish an Event (unauthenticated Device)</h2>

<ul>
<li>URI: <code>/event/${tenantId}/${deviceId}</code></li>
<li>Method: <code>PUT</code></li>
<li>Request Headers:

<ul>
<li>(required) <code>Content-Type</code>: The type of payload contained in the body.</li>
<li>(optional) <code>hono-ttd</code>: The number of seconds the device will wait for the response.</li>
</ul></li>
<li>Request Body:

<ul>
<li>(required) Arbitrary payload encoded according to the given content type.</li>
</ul></li>
<li>Status Codes:

<ul>
<li>202 (Accepted): The event has been accepted and put to a persistent store for delivery to consumers.</li>
<li>400 (Bad Request): The request cannot be processed because the content type header is missing or the request body is empty.</li>
<li>403 (Forbidden): The request cannot be processed because the device&rsquo;s registration status cannot be asserted. Possible reasons for this might be:

<ul>
<li>The given tenant is not allowed to use this protocol adapter.</li>
<li>The given device does not belong to the given tenant.</li>
<li>The given device is disabled.</li>
</ul></li>
<li>503 (Service Unavailable): The request cannot be processed because there is no consumer of events for the given tenant connected to Hono.</li>
</ul></li>
</ul>

<p>This resource MUST be used by devices that have not authenticated to the protocol adapter. Note that this requires the <code>HONO_HTTP_AUTHENTICATION_REQUIRED</code> configuration property to be explicitly set to <code>false</code>.</p>

<p><strong>Examples</strong></p>

<p>Publish some JSON data for device <code>4711</code>:</p>

<pre><code>$ curl -i -X PUT -H 'Content-Type: application/json' \
$ --data-binary '{&quot;alarm&quot;: true}' http://127.0.0.1:8080/event/DEFAULT_TENANT/4711

HTTP/1.1 202 Accepted
Content-Length: 0
</code></pre>

<h2 id="publish-an-event-authenticated-gateway">Publish an Event (authenticated Gateway)</h2>

<ul>
<li>URI: <code>/event/${tenantId}/${deviceId}</code></li>
<li>Method: <code>PUT</code></li>
<li>Request Headers:

<ul>
<li>(optional) <code>Authorization</code>: The gateway&rsquo;s <em>auth-id</em> and plain text password encoded according to the <a href="https://tools.ietf.org/html/rfc7617">Basic HTTP authentication scheme</a>. If not set, the adapter expects the gateway to present a client certificate as part of the TLS handshake during connection establishment.</li>
<li>(required) <code>Content-Type</code>: The type of payload contained in the body.</li>
<li>(optional) <code>hono-ttd</code>: The number of seconds the device will wait for the response.</li>
</ul></li>
<li>Request Body:

<ul>
<li>(required) Arbitrary payload encoded according to the given content type.</li>
</ul></li>
<li>Status Codes:

<ul>
<li>202 (Accepted): The event has been accepted and put to a persistent store for delivery to consumers.</li>
<li>400 (Bad Request): The request cannot be processed because the content type header is missing or the request body is empty.</li>
<li>403 (Forbidden): The request cannot be processed because the device&rsquo;s registration status cannot be asserted. Possible reasons for this might be:

<ul>
<li>The given tenant is not allowed to use this protocol adapter.</li>
<li>The given device does not belong to the given tenant.</li>
<li>The given device is disabled.</li>
</ul></li>
<li>503 (Service Unavailable): The request cannot be processed because there is no consumer of telemetry data for the given tenant connected to Hono.</li>
</ul></li>
</ul>

<p>This resource can be used by <em>gateway</em> components to publish data <em>on behalf of</em> other devices which do not connect to a protocol adapter directly but instead are connected to the gateway, e.g. using some low-bandwidth radio based technology like <a href="https://www.sigfox.com">SigFox</a> or <a href="https://www.lora-alliance.org/">LoRa</a>. In this case the credentials provided by the gateway during connection establishment with the protocol adapter are used to authenticate the gateway whereas the parameters from the URI are used to identify the device that the gateway publishes data for.</p>

<p>The protocol adapter checks the gateway&rsquo;s authority to publish data on behalf of the device implicitly by means of retrieving a <em>registration assertion</em> for the device from the <a href="#device-registration-service-connection-configuration">configured Device Registration service</a>.</p>

<p><strong>Examples</strong></p>

<p>Publish some JSON data for device <code>4712</code> via gateway <code>gw-1</code>:</p>

<pre><code>$ curl -i -X PUT -u gw@DEFAULT_TENANT:gw-secret -H 'Content-Type: application/json' \
$ --data-binary '{&quot;temp&quot;: 5}' http://127.0.0.1:8080/event/DEFAULT_TENANT/4712

HTTP/1.1 202 Accepted
Content-Length: 0
</code></pre>

<p><strong>NB</strong>: The example above assumes that a gateway device with ID <code>gw-1</code> has been registered with <code>hashed-password</code> credentials with <em>auth-id</em> <code>gw</code> and password <code>gw-secret</code>.</p>

<h2 id="downstream-meta-data">Downstream Meta Data</h2>

<p>The adapter includes the following meta data in the application properties of messages being sent downstream:</p>

<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Type</th>
<th align="left">Description</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left"><em>orig_adapter</em></td>
<td align="left"><em>string</em></td>
<td align="left">Contains the adapter&rsquo;s <em>type name</em> which can be used by downstream consumers to determine the protocol adapter that the message has been received over. The HTTP adapter&rsquo;s type name is <code>hono-http</code>.</td>
</tr>

<tr>
<td align="left"><em>orig_address</em></td>
<td align="left"><em>string</em></td>
<td align="left">Contains the (relative) URI that the device has originally posted the data to.</td>
</tr>
</tbody>
</table>

<p>The adapter also considers <a href="/hono/api/device-registration-api/#payload-format"><em>defaults</em> registered for the device</a>. For each default value the adapter checks if a corresponding property is already set on the message and if not, sets the message&rsquo;s property to the registered default value or adds a corresponding application property.</p>

<p>Note that of the standard AMQP 1.0 message properties only the <em>content-type</em> can be set this way to a registered default value.</p>

<h2 id="specifying-the-time-a-device-will-wait-for-a-response">Specifying the time a device will wait for a response</h2>

<p>The adapter lets devices specify the number of seconds they will wait for a response by setting a header or a query parameter.</p>

<div class="admonition note">
<p class="admonition-title"></p>
<p>This feature has been added in Hono 0.6. Previous versions of the adapter do not support it.</p>
</div>

<p>The parameter is available for all variants <code>authenticated</code>, <code>unauthenticated</code> and <code>authenticated gateway</code>. For simplification
only the <code>authenticated</code> URI is used below.</p>

<h3 id="use-a-specific-http-header">Use a specific HTTP header</h3>

<p>The optional header <code>hono-ttd</code> can be set for any downstream message.</p>

<p>Example:</p>

<pre><code>$ curl -i -X POST -u sensor1@DEFAULT_TENANT:hono-secret -H 'Content-Type: application/json' -H 'hono-ttd: 60' \
$ --data-binary '{&quot;temp&quot;: 5}' http://127.0.0.1:8080/telemetry

HTTP/1.1 202 Accepted
Content-Length: 0
</code></pre>

<h3 id="use-a-query-parameter">Use a query parameter</h3>

<p>Alternatively the value for <code>hono-ttd</code> can be set by using a query parameter.</p>

<p>Example:</p>

<pre><code>$ curl -i -X POST -u sensor1@DEFAULT_TENANT:hono-secret -H 'Content-Type: application/json' \
$ --data-binary '{&quot;temp&quot;: 5}' http://127.0.0.1:8080/telemetry?hono-ttd=60

HTTP/1.1 202 Accepted
Content-Length: 0
</code></pre>

<h2 id="sending-a-response-to-a-previously-received-command">Sending a response to a previously received command</h2>

<div class="admonition note">
<p class="admonition-title"></p>
<p>This feature has been added in Hono 0.7. Previous versions of the adapter do not support it.</p>
</div>

<h3 id="sending-a-response-authenticated-device">Sending a response (authenticated Device)</h3>

<ul>
<li>URI: <code>/control/res/${commandRequestId}</code> or <code>/control/res/${commandRequestId}?hono-cmd-status=${status}</code></li>
<li>Method: <code>POST</code></li>
<li>Request Headers:

<ul>
<li>(optional) <code>Authorization</code>: The device&rsquo;s <em>auth-id</em> and plain text password encoded according to the <a href="https://tools.ietf.org/html/rfc7617">Basic HTTP authentication scheme</a>. If not set, the adapter expects the device to present a client certificate as part of the TLS handshake during connection establishment.</li>
<li>(optional) <code>hono-cmd-status</code>: The status of the command execution. If not set, the adapter expects that the URI contains it
as request parameter at the end.</li>
</ul></li>
<li>Request Body:

<ul>
<li>(optional) Arbitrary payload. The type of the payload should be determined by the command that was sent to the device previously
and is unknown to Hono.</li>
</ul></li>
<li>Status Codes:

<ul>
<li>202 (Accepted): The response has been accepted and was successfully delivered to the application.</li>
<li>400 (Bad Request): The request cannot be processed because the command status is missing.</li>
<li>401 (Unauthorized): The request cannot be processed because the request does not contain valid credentials.<br /></li>
<li>403 (Forbidden): The request cannot be processed because the device&rsquo;s registration status cannot be asserted. Possible reasons for this might be:

<ul>
<li>The given tenant is not allowed to use this protocol adapter.</li>
<li>The given device is disabled.</li>
</ul></li>
<li>503 (Service Unavailable): The request cannot be processed because there is no application listening for a reply to
this <code>commandRequestId</code>. One possible reason can be that the response is sent later as the timeout the application has set for waiting
for it.</li>
</ul></li>
</ul>

<p>This is the preferred way for devices to respond to commands. It is available only if the protocol adapter is configured to require devices to authenticate (which is the default).</p>

<p><strong>Example</strong></p>

<p>Send a response to a previously received command with the command-request-id <code>2fcmd-client-bed7bdad-facc-4f72-9b8b-da6e5be8db32dd09ffe2-fa96-4eb1-975f-1e4adb7d191c</code> for device <code>4711</code>:</p>

<pre><code>$ curl -i -X POST -u sensor1@DEFAULT_TENANT:hono-secret \
$ --data-binary '{&quot;brightness-changed&quot;: true}' \
$ http://127.0.0.1:8080/control/res/2fcmd-client-bed7bdad-facc-4f72-9b8b-da6e5be8db32dd09ffe2-fa96-4eb1-975f-1e4adb7d191c?hono-cmd-status=200

HTTP/1.1 202 Accepted
Content-Length: 0
</code></pre>

<h2 id="sending-a-response-unauthenticated-device">Sending a response (unauthenticated Device)</h2>

<ul>
<li>URI: <code>/control/res/${tenantId}/${deviceId}/${commandRequestId}</code> or <code>/control/res/${tenantId}/${deviceId}/${commandRequestId}?hono-cmd-status=${status}</code></li>
<li>Method: <code>PUT</code></li>
<li>Request Headers:

<ul>
<li>(optional) <code>hono-cmd-status</code>: The status of the command execution. If not set, the adapter expects that the URI contains it
as request parameter at the end.</li>
</ul></li>
<li>Request Body:

<ul>
<li>(optional) Arbitrary payload. The type of the payload should be determined by the command that was sent to the device previously
and is unknown to Hono.</li>
</ul></li>
<li>Status Codes:

<ul>
<li>202 (Accepted): The event has been accepted and put to a persistent store for delivery to consumers.</li>
<li>400 (Bad Request): The request cannot be processed because the command status is missing.</li>
<li>403 (Forbidden): The request cannot be processed because the device&rsquo;s registration status cannot be asserted. Possible reasons for this might be:

<ul>
<li>The given tenant is not allowed to use this protocol adapter.</li>
<li>The given device does not belong to the given tenant.</li>
<li>The given device is disabled.</li>
</ul></li>
<li>503 (Service Unavailable): The request cannot be processed because there is no application listening for a reply to
this <code>commandRequestId</code>. One possible reason can be that the response is sent later as the timeout the application has set to wait
for it.</li>
</ul></li>
</ul>

<p>This resource MUST be used by devices that have not authenticated to the protocol adapter. Note that this requires the <code>HONO_HTTP_AUTHENTICATION_REQUIRED</code> configuration property to be explicitly set to <code>false</code>.</p>

<p><strong>Examples</strong></p>

<p>Send a response to a previously received command with the command-request-id <code>2fcmd-client-bed7bdad-facc-4f72-9b8b-da6e5be8db32dd09ffe2-fa96-4eb1-975f-1e4adb7d191c</code> for the unauthenticated device <code>4711</code>:</p>

<pre><code>$ curl -i -X PUT --data-binary '{&quot;brightness-changed&quot;: true}' \
$ http://127.0.0.1:8080/control/res/DEFAULT_TENANT/4711/2fcmd-client-bed7bdad-facc-4f72-9b8b-da6e5be8db32dd09ffe2-fa96-4eb1-975f-1e4adb7d191c?hono-cmd-status=200

HTTP/1.1 202 Accepted
Content-Length: 0
</code></pre>

<h2 id="sending-a-response-authenticated-gateway">Sending a response (authenticated Gateway)</h2>

<ul>
<li>URI: <code>/control/res/${tenantId}/${deviceId}/${commandRequestId}</code> or <code>/control/res/${tenantId}/${deviceId}/${commandRequestId}?hono-cmd-status=${status}</code></li>
<li>Method: <code>PUT</code></li>
<li>Request Headers:

<ul>
<li>(optional) <code>Authorization</code>: The gateway&rsquo;s <em>auth-id</em> and plain text password encoded according to the <a href="https://tools.ietf.org/html/rfc7617">Basic HTTP authentication scheme</a>. If not set, the adapter expects the gateway to present a client certificate as part of the TLS handshake during connection establishment.</li>
<li>(optional) <code>hono-cmd-status</code>: The status of the command execution. If not set, the adapter expects that the URI contains it
as request parameter at the end.</li>
</ul></li>
<li>Request Body:

<ul>
<li>(optional) Arbitrary payload. The type of the payload should be determined by the command that was sent to the device previously
and is unknown to Hono.</li>
</ul></li>
<li>Status Codes:

<ul>
<li>202 (Accepted): The event has been accepted and put to a persistent store for delivery to consumers.</li>
<li>400 (Bad Request): The request cannot be processed because the command status is missing.</li>
<li>403 (Forbidden): The request cannot be processed because the device&rsquo;s registration status cannot be asserted. Possible reasons for this might be:

<ul>
<li>The given tenant is not allowed to use this protocol adapter.</li>
<li>The given device does not belong to the given tenant.</li>
<li>The given device is disabled.</li>
</ul></li>
<li>503 (Service Unavailable): The request cannot be processed because there is no application listening for a reply to
this <code>commandRequestId</code>. One possible reason can be that the response is sent later as the timeout the application has set to wait
for it.</li>
</ul></li>
</ul>

<p>This resource can be used by <em>gateway</em> components to send the response to a command <em>on behalf of</em> other devices which do not connect to a protocol adapter directly but instead are connected to the gateway, e.g. using some low-bandwidth radio based technology like <a href="https://www.sigfox.com">SigFox</a> or <a href="https://www.lora-alliance.org/">LoRa</a>. In this case the credentials provided by the gateway during connection establishment with the protocol adapter are used to authenticate the gateway whereas the parameters from the URI are used to identify the device that the gateway publishes data for.</p>

<p>The protocol adapter checks the gateway&rsquo;s authority to send responses to a command on behalf of the device implicitly by means of retrieving a <em>registration assertion</em> for the device from the <a href="#device-registration-service-connection-configuration">configured Device Registration service</a>.</p>

<p><strong>Examples</strong></p>

<p>Publish some JSON data for device <code>4712</code> via gateway <code>gw-1</code>:</p>

<p>Send a response to a previously received command with the command-request-id <code>2fcmd-client-bed7bdad-facc-4f72-9b8b-da6e5be8db32dd09ffe2-fa96-4eb1-975f-1e4adb7d191c</code> for the unauthenticated device <code>4711</code>
 via gateway <code>gw-1</code>:</p>

<pre><code>$ curl -i -X PUT -u gw@DEFAULT_TENANT:gw-secret --data-binary '{&quot;brightness-changed&quot;: true}' \
$ http://127.0.0.1:8080/control/res/DEFAULT_TENANT/4712/2fcmd-client-bed7bdad-facc-4f72-9b8b-da6e5be8db32dd09ffe2-fa96-4eb1-975f-1e4adb7d191c?hono-cmd-status=200

HTTP/1.1 202 Accepted
Content-Length: 0
</code></pre>

<p><strong>NB</strong>: The example above assumes that a gateway device with ID <code>gw-1</code> has been registered with <code>hashed-password</code> credentials with <em>auth-id</em> <code>gw</code> and password <code>gw-secret</code>.</p>

<h2 id="tenant-specific-configuration">Tenant specific Configuration</h2>

<p>The adapter uses the <a href="/hono/api/tenant-api/#get-tenant-information">Tenant API</a> to retrieve <em>tenant specific configuration</em> for adapter type <code>hono-http</code>.
The following properties are (currently) supported:</p>

<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Type</th>
<th align="left">Default Value</th>
<th align="left">Description</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left"><em>enabled</em></td>
<td align="left"><em>boolean</em></td>
<td align="left"><code>true</code></td>
<td align="left">If set to <code>false</code> the adapter will reject all data from devices belonging to the tenant.</td>
</tr>
</tbody>
</table>

      <aside class="copyright" role="note">
  <div class="logo">
    <a href="https://www.eclipse.org" target="_blank">
      <img src="https://www.eclipse.org/hono/images/eclipse_foundation_logo.png" />
    </a>
  </div>
  <p class="notice">
    
    &copy; 2018 The Eclipse Hono Project &ndash;
    
    Documentation built with
    <a href="https://www.gohugo.io" target="_blank">Hugo</a>
    using the
    <a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
  </p>
  <p class="quickLinks">
    <a href="http://www.eclipse.org/legal/privacy.php" target="_blank">
      &gt; Privacy Policy
    </a>
    <a href="http://www.eclipse.org/legal/termsofuse.php" target="_blank">
      &gt; Terms of Use
    </a>
    <a href="http://www.eclipse.org/legal/copyright.php" target="_blank">
      &gt; Copyright Agent
    </a>
    <a href="http://www.eclipse.org/legal" target="_blank">
      &gt; Legal
    </a>
    <a href="https://eclipse.org/security" target="_blank">
      &gt; Report a Vulnerability
    </a>
  </p>
</aside>


			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://www.eclipse.org/hono/user-guide/device-registry/" title="Device Registry">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Device Registry
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://www.eclipse.org/hono/user-guide/mqtt-adapter/" title="MQTT Adapter">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              MQTT Adapter
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>






			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/www.eclipse.org\/hono\/';
      var repo_id  = 'eclipse\/hono';
    
    </script>

    <script src="https://www.eclipse.org/hono/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            if(!headers[i].id)
                a.setAttribute("href", headers[i].parentNode.href);
            else
                a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    
      
      <script>
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-5WLCZXC');
      </script>
    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

